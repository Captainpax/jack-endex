/* --- FILE: client/src/style.css ------------------------------------------
   AntiMatter Zone â€¢ UI Base
   - System color variables (light/dark)
   - Accessible focus rings & states
   - Responsive spacing & layout helpers
   - Polished cards, buttons, tabs, inputs, pills
   ------------------------------------------------------------------------ */

/* Color system */
:root {
    --bg: #f3f4f6;
    --surface: #ffffff;
    --surface-2: #f9fafb;
    --text: #111827;
    --muted: #6b7280;
    --border: #e5e7eb;

    --brand: #3b82f6;
    --brand-600: #2563eb;
    --brand-700: #1d4ed8;

    --success: #16a34a;
    --warning: #f59e0b;
    --danger: #ef4444;

    --shadow-sm: 0 1px 3px rgba(0,0,0,.1);
    --shadow-md: 0 6px 18px rgba(0,0,0,.08);

    --radius-sm: 6px;
    --radius: 12px;
    --radius-lg: 20px;

    --focus: 0 0 0 3px rgba(59,130,246,.35);
    --focus-strong: 0 0 0 3px rgba(59,130,246,.5);

    --trans-fast: 120ms;
    --trans: 200ms;

    --font: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial, "Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol", sans-serif;
}

/* Respect system dark mode */
@media (prefers-color-scheme: dark) {
    :root {
        --bg: #0b0c10;
        --surface: #0f1115;
        --surface-2: #11131a;
        --text: #e5e7eb;
        --muted: #9aa3b2;
        --border: #1f2937;

        --brand: #60a5fa;
        --brand-600: #3b82f6;
        --brand-700: #2563eb;

        --shadow-sm: 0 1px 3px rgba(0,0,0,.4);
        --shadow-md: 0 10px 24px rgba(0,0,0,.35);

        --focus: 0 0 0 3px rgba(96,165,250,.4);
        --focus-strong: 0 0 0 3px rgba(96,165,250,.55);
    }
}

/* Optional manual dark mode: add .theme-dark on <html> or <body> */
.theme-dark {
    --bg: #0b0c10;
    --surface: #0f1115;
    --surface-2: #11131a;
    --text: #e5e7eb;
    --muted: #9aa3b2;
    --border: #1f2937;

    --brand: #60a5fa;
    --brand-600: #3b82f6;
    --brand-700: #2563eb;

    --shadow-sm: 0 1px 3px rgba(0,0,0,.4);
    --shadow-md: 0 10px 24px rgba(0,0,0,.35);

    --focus: 0 0 0 3px rgba(96,165,250,.4);
    --focus-strong: 0 0 0 3px rgba(96,165,250,.55);
}

/* Base */
*,
*::before,
*::after { box-sizing: border-box; }

html, body {
    height: 100%;
}

body {
    margin: 0;
    font-family: var(--font), sans-serif;
    background: var(--bg);
    color: var(--text);
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
}

#root {
    min-height: 100vh;
    padding: clamp(16px, 3vw, 32px);
}

.loading-bar {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    z-index: 4000;
    pointer-events: none;
    opacity: 0;
    transform: translateY(-100%);
    transition: opacity 160ms ease, transform 160ms ease;
}

.loading-bar--visible {
    opacity: 1;
    transform: translateY(0);
}

.loading-bar__track {
    position: relative;
    width: 100%;
    height: 100%;
    overflow: hidden;
    background: rgba(59, 130, 246, 0.18);
    border-radius: 999px;
}

.loading-bar__indicator {
    position: absolute;
    inset: 0;
}

.loading-bar__indicator::before,
.loading-bar__indicator::after {
    content: "";
    position: absolute;
    top: 0;
    bottom: 0;
    left: 0;
    border-radius: inherit;
    background: linear-gradient(90deg, var(--brand-600), var(--brand-700));
    transform: translateX(-120%);
}

.loading-bar__indicator::before {
    width: 42%;
    animation: loading-bar-primary 1.2s cubic-bezier(0.4, 0, 0.2, 1) infinite;
}

.loading-bar__indicator::after {
    width: 26%;
    animation: loading-bar-secondary 1.2s cubic-bezier(0.4, 0, 0.2, 1) infinite;
    animation-delay: 0.2s;
}

.loading-bar--finishing .loading-bar__indicator::before,
.loading-bar--finishing .loading-bar__indicator::after {
    animation: none;
    width: 100%;
    transform: translateX(0);
    opacity: 0.85;
    transition: transform 200ms ease, width 200ms ease, opacity 200ms ease;
}

.loading-bar--finishing .loading-bar__indicator::after {
    opacity: 0;
}

@keyframes loading-bar-primary {
    0% {
        transform: translateX(-120%);
    }
    55% {
        transform: translateX(125%);
    }
    100% {
        transform: translateX(125%);
    }
}

@keyframes loading-bar-secondary {
    0% {
        transform: translateX(-130%);
    }
    45% {
        transform: translateX(120%);
    }
    100% {
        transform: translateX(120%);
    }
}

/* Typography */
h1, h2, h3, h4 {
    margin: 0 0 .5rem;
    line-height: 1.2;
    letter-spacing: .2px;
}
h1 { font-size: clamp(1.8rem, 1.2rem + 1.5vw, 2.4rem); }
h2 { font-size: clamp(1.4rem, 1.1rem + 1vw, 1.8rem); }
h3 { font-size: clamp(1.1rem, 1rem + .6vw, 1.25rem); }
h4 { font-size: 1rem; color: var(--muted); font-weight: 600; }
p  { margin: 0 0 .75rem; color: var(--text); }

/* Layout helpers */
.row {
    display: flex;
    gap: 8px;
    align-items: center;
}

.row.wrap {
    flex-wrap: wrap;
}

.col {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

/* Stack with larger gaps */
.stack-sm { display: grid; gap: 8px; }
.stack    { display: grid; gap: 12px; }
.stack-lg { display: grid; gap: 16px; }

/* Responsive grid */
.grid {
    display: grid;
    gap: 12px;
    grid-template-columns: repeat(12, minmax(0, 1fr));
}
@media (max-width: 900px) {
    .grid { grid-template-columns: repeat(6, minmax(0, 1fr)); }
}
@media (max-width: 640px) {
    .grid { grid-template-columns: repeat(2, minmax(0, 1fr)); }
}

/* Card */
.card {
    background: var(--surface);
    padding: 16px;
    border-radius: var(--radius);
    box-shadow: var(--shadow-sm);
    border: 1px solid var(--border);
    transition: box-shadow var(--trans), transform var(--trans);
}
.card:hover {
    box-shadow: var(--shadow-md);
}
.card .header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 8px;
    margin-bottom: 8px;
}

/* Lists */
.list {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.list .row {
    align-items: center;
}

/* Divider */
.divider {
    height: 1px;
    background: var(--border);
    margin: 8px 0;
    border-radius: 1px;
}

/* Buttons */
.btn {
    --btn-bg: var(--brand);
    --btn-bg-hover: var(--brand-600);
    --btn-bg-active: var(--brand-700);
    --btn-fg: #fff;
    --btn-border: transparent;
    --btn-border-hover: transparent;
    --btn-border-active: transparent;
    --btn-ring: var(--focus);

    background: var(--btn-bg);
    color: var(--btn-fg);
    border: 1px solid var(--btn-border);
    padding: 8px 16px;
    border-radius: var(--radius-sm);
    cursor: pointer;
    font-weight: 600;
    letter-spacing: .01em;
    line-height: 1.1;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    transition:
        transform var(--trans-fast),
        background var(--trans-fast),
        box-shadow var(--trans-fast),
        opacity var(--trans-fast),
        border-color var(--trans-fast);
    box-shadow: 0 1px 1px rgba(0, 0, 0, .05);
    user-select: none;
}
.btn:hover {
    background: var(--btn-bg-hover);
    border-color: var(--btn-border-hover);
}
.btn:active {
    background: var(--btn-bg-active);
    border-color: var(--btn-border-active);
    transform: translateY(1px);
}
.btn:focus-visible { outline: none; box-shadow: var(--btn-ring); }
.btn:disabled,
.btn[disabled] { opacity: .6; cursor: not-allowed; transform: none; }

/* Button variants */
.btn.secondary {
    --btn-bg: var(--surface-2);
    --btn-bg-hover: #e5e7eb;
    --btn-bg-active: #d1d5db;
    --btn-fg: var(--text);
    --btn-border: var(--border);
    --btn-border-hover: color-mix(in oklab, var(--border) 60%, var(--brand) 40%);
    --btn-border-active: color-mix(in oklab, var(--border) 40%, var(--brand) 60%);
}

/* Invite feedback */
.invite-button {
    display: flex;
    flex-direction: column;
    gap: 8px;
    align-items: flex-end;
    position: relative;
}

.invite-feedback {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius-sm);
    box-shadow: var(--shadow-sm);
    padding: 12px 14px;
    width: min(320px, 90vw);
    text-align: left;
    animation: fade-in-up var(--trans) ease;
}

.invite-feedback strong {
    color: var(--brand-600);
    font-size: .95rem;
}

.invite-feedback__row {
    display: grid;
    gap: 4px;
    margin-top: 8px;
}

.invite-feedback__row span {
    color: var(--muted);
    font-size: .75rem;
    text-transform: uppercase;
    letter-spacing: .04em;
}

.invite-feedback__row code {
    display: block;
    background: var(--surface-2);
    padding: 6px 8px;
    border-radius: var(--radius-sm);
    font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;
    font-size: .8rem;
    border: 1px dashed var(--border);
    word-break: break-word;
}

.invite-feedback__note {
    display: block;
    margin-top: 8px;
    font-size: .8rem;
    color: var(--muted);
}

@keyframes fade-in-up {
    from {
        opacity: 0;
        transform: translateY(6px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}
.btn.ghost {
    --btn-bg: transparent;
    --btn-bg-hover: color-mix(in oklab, var(--brand) 12%, transparent);
    --btn-bg-active: color-mix(in oklab, var(--brand) 24%, transparent);
    --btn-fg: var(--brand-600);
    --btn-border: color-mix(in oklab, var(--brand) 38%, transparent);
    --btn-border-hover: color-mix(in oklab, var(--brand) 48%, transparent);
    --btn-border-active: color-mix(in oklab, var(--brand) 58%, transparent);
    box-shadow: none;
}
.btn.success { --btn-bg: var(--success); --btn-bg-hover: #15803d; --btn-bg-active: #166534; }
.btn.warn    { --btn-bg: var(--warning); --btn-bg-hover: #d97706; --btn-bg-active: #b45309; }
.btn.danger  { --btn-bg: var(--danger); --btn-bg-hover: #dc2626; --btn-bg-active: #b91c1c; }

.btn.btn-small {
    padding: 6px 12px;
    font-size: .8rem;
    border-radius: calc(var(--radius-sm) - 2px);
}

/* Icon button */
.icon-btn {
    display: inline-grid;
    place-items: center;
    width: 34px;
    height: 34px;
    border-radius: 10px;
    background: var(--surface-2);
    border: 1px solid var(--border);
    color: var(--text);
    cursor: pointer;
    transition: background var(--trans-fast), box-shadow var(--trans-fast), transform var(--trans-fast);
}
.icon-btn:hover { background: color-mix(in oklab, var(--surface-2) 70%, var(--brand) 30%); }
.icon-btn:focus-visible { outline: none; box-shadow: var(--focus); }
.icon-btn:active { transform: translateY(1px); }

/* Tabs */
.tabs {
    display: flex;
    gap: 8px;
    border-bottom: 1px solid var(--border);
}
.tab {
    padding: 10px 12px;
    cursor: pointer;
    border-bottom: 2px solid transparent;
    color: var(--muted);
    font-weight: 600;
    transition: color var(--trans-fast), border-color var(--trans-fast), background var(--trans-fast);
    border-top-left-radius: 10px;
    border-top-right-radius: 10px;
}
.tab:hover {
    color: var(--text);
    background: var(--surface);
}
.tab.active {
    border-color: var(--brand);
    color: var(--text);
    background: var(--surface);
}

/* Battle map */
.map-tab {
    display: grid;
    gap: 16px;
}

.map-toolbar {
    display: grid;
    gap: 12px;
}

.map-toolbar__row {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    flex-wrap: wrap;
    gap: 12px;
}

.map-toolbar__tools {
    display: grid;
    gap: 6px;
    flex: 1 1 280px;
}

.map-toolbar__buttons {
    display: flex;
    gap: 8px;
}

.map-toolbar__utilities {
    display: flex;
    gap: 8px;
    margin-top: 6px;
    flex-wrap: wrap;
}

.map-toolbar__drawer {
    display: grid;
    gap: 6px;
    min-width: 220px;
    flex: 1 1 220px;
}

.map-toolbar__drawer select {
    width: 100%;
    min-height: 32px;
}

.map-toolbar__drawer-status {
    display: flex;
    align-items: center;
    gap: 8px;
    flex-wrap: wrap;
}

.map-toolbar__drawer-name {
    font-weight: 600;
}

.map-toolbar .btn.is-active {
    box-shadow: var(--focus);
}

.map-toolbar__status {
    display: flex;
    align-items: center;
    gap: 12px;
    flex-wrap: wrap;
}

.map-toolbar__brush {
    display: flex;
    align-items: center;
    gap: 24px;
    flex-wrap: wrap;
}

.map-toolbar__colors {
    display: flex;
    gap: 6px;
}

.map-color-picker {
    display: grid;
    gap: 4px;
    margin-top: 8px;
}

.map-brush-save {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-top: 12px;
    flex-wrap: wrap;
}

.map-brush-save label {
    min-width: 120px;
}

.map-color {
    width: 28px;
    height: 28px;
    border-radius: 50%;
    border: 2px solid transparent;
    cursor: pointer;
    transition: transform var(--trans-fast), border-color var(--trans-fast), box-shadow var(--trans-fast);
}

.map-color:hover {
    transform: translateY(-2px);
}

.map-color.is-active {
    border-color: rgba(255, 255, 255, 0.8);
    box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.35), 0 0 0 4px rgba(15, 23, 42, 0.2);
}

.color-input {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    font-size: 0.85rem;
}
.color-input input[type="color"] {
    appearance: none;
    border: 1px solid rgba(148, 163, 184, 0.45);
    padding: 0;
    width: 40px;
    height: 28px;
    border-radius: var(--radius-sm);
    cursor: pointer;
    background-color: transparent;
}
.color-input input[type="color"]::-webkit-color-swatch-wrapper {
    padding: 0;
}
.color-input input[type="color"]::-webkit-color-swatch {
    border: none;
    border-radius: var(--radius-sm);
}
.color-input input[type="color"]::-moz-color-swatch {
    border: none;
    border-radius: var(--radius-sm);
}
.color-input input[type="color"]::-webkit-color-swatch {
    border-radius: var(--radius-sm);
    border: 1px solid var(--border);
}
.color-input input[type="color"]::-webkit-color-swatch-wrapper {
    padding: 0;
}
.color-input input[type="color"]::-moz-color-swatch {
    border-radius: var(--radius-sm);
    border: 1px solid var(--border);
}

.map-brush-size {
    display: grid;
    gap: 6px;
    min-width: 160px;
}

.map-toolbar__settings {
    gap: 16px;
    align-items: center;
    flex-wrap: wrap;
}

.map-layout {
    display: grid;
    gap: 16px;
    grid-template-columns: minmax(0, 2fr) minmax(0, 1fr);
    align-items: start;
}

@media (max-width: 960px) {
    .map-layout {
        grid-template-columns: minmax(0, 1fr);
    }
}

.map-board {
    position: relative;
    padding: 0;
    overflow: hidden;
    min-height: 400px;
    border-radius: var(--radius-lg);
    background-color: var(--map-board-color, #0f172a);
    background-image: linear-gradient(135deg, rgba(59, 130, 246, 0.06), rgba(59, 130, 246, 0.12));
}

.map-board__background,
.map-board__shapes,
.map-board__tokens {
    position: absolute;
    inset: 0;
}

.map-board__background {
    z-index: 0;
    overflow: hidden;
}

.map-board__background-image {
    position: absolute;
    top: 0;
    left: 0;
    max-width: none;
    max-height: none;
    transform-origin: center;
    user-select: none;
    pointer-events: inherit;
}

.map-board__canvas {
    position: relative;
    z-index: 1;
    width: 100%;
    height: 100%;
    display: block;
    touch-action: none;
    background: transparent;
}

.map-board__shapes {
    z-index: 2;
    pointer-events: none;
}

.map-board__tokens {
    z-index: 3;
}

.map-shape {
    position: absolute;
    transform-origin: center;
    transform: translate(-50%, -50%);
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(15, 23, 42, 0.25);
    transition: box-shadow var(--trans-fast), transform var(--trans-fast);
    pointer-events: auto;
    overflow: hidden;
}

.map-shape--line {
    border-radius: 999px;
}

.map-shape--circle,
.map-shape--circle .map-shape__surface,
.map-shape--line .map-shape__surface {
    border-radius: 999px;
}

.map-shape--diamond,
.map-shape--triangle,
.map-shape--cone {
    border-radius: 0;
}

.map-shape--diamond .map-shape__surface {
    clip-path: polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%);
}

.map-shape--triangle .map-shape__surface {
    clip-path: polygon(50% 0%, 100% 100%, 0% 100%);
}

.map-shape--cone .map-shape__surface {
    clip-path: polygon(50% 0%, 100% 88%, 50% 100%, 0% 88%);
}

.map-shape:hover {
    box-shadow: 0 8px 18px rgba(15, 23, 42, 0.35);
}

.map-shape__surface {
    width: 100%;
    height: 100%;
    border-radius: inherit;
}

.map-shape__image {
    width: 100%;
    height: 100%;
    object-fit: contain;
    display: block;
}

.map-shape__empty {
    width: 100%;
    height: 100%;
    display: grid;
    place-items: center;
    text-align: center;
    font-size: 0.78rem;
    padding: 12px;
    color: var(--muted);
    background: rgba(15, 23, 42, 0.4);
}

.map-shape.is-selected {
    box-shadow: 0 10px 26px rgba(15, 23, 42, 0.45);
    overflow: visible;
}

.map-shape.is-selected::after {
    content: "";
    position: absolute;
    inset: 0;
    border-radius: inherit;
    border: 2px solid color-mix(in oklab, var(--brand) 70%, #fff 30%);
    pointer-events: none;
    box-shadow: inset 0 0 0 1px rgba(15, 23, 42, 0.35);
}

.map-shape__handle {
    position: absolute;
    width: 20px;
    height: 20px;
    border-radius: 999px;
    border: 2px solid #fff;
    background: color-mix(in oklab, var(--brand) 75%, #fff 25%);
    box-shadow: 0 6px 12px rgba(15, 23, 42, 0.35);
    pointer-events: auto;
    touch-action: none;
    display: block;
    z-index: 2;
}

.map-shape__handle::after {
    content: "";
    position: absolute;
    inset: 3px;
    border-radius: inherit;
    background: color-mix(in oklab, var(--brand) 55%, #0f172a 45%);
}

.map-shape__handle--scale {
    right: -16px;
    bottom: -16px;
    cursor: nwse-resize;
}

.map-shape__handle--rotate {
    top: -34px;
    left: 50%;
    transform: translate(-50%, 0);
    cursor: grab;
}

.map-shape__handle--rotate:active {
    cursor: grabbing;
}

.map-token {
    position: absolute;
    transform: translate(-50%, -50%);
    border-radius: 999px;
    min-width: 34px;
    min-height: 34px;
    border: 2px solid rgba(255, 255, 255, 0.75);
    box-shadow: 0 6px 16px rgba(15, 23, 42, 0.35);
    display: flex;
    align-items: center;
    justify-content: center;
    color: #fff;
    font-weight: 700;
    letter-spacing: .05em;
    cursor: default;
    transition: transform var(--trans-fast), box-shadow var(--trans-fast);
}

.map-token.is-draggable {
    cursor: grab;
}

.map-token.is-draggable:hover {
    transform: translate(-50%, -50%) scale(1.06);
    box-shadow: 0 10px 20px rgba(15, 23, 42, 0.45);
}

.map-token__label {
    pointer-events: none;
}

.map-token__tooltip {
    position: absolute;
    bottom: calc(100% + 10px);
    left: 50%;
    transform: translateX(-50%);
    background: rgba(15, 23, 42, 0.92);
    color: #fff;
    padding: 6px 10px;
    border-radius: 8px;
    font-size: 12px;
    white-space: nowrap;
    pointer-events: none;
    opacity: 0;
    transition: opacity var(--trans-fast), transform var(--trans-fast);
}

.map-token:hover .map-token__tooltip {
    opacity: 1;
    transform: translate(-50%, -2px);
}

.map-token__tooltip--card {
    padding: 0;
    background: transparent;
    box-shadow: none;
    white-space: normal;
}

.map-token__tooltip-card {
    display: grid;
    gap: 8px;
    background: rgba(15, 23, 42, 0.92);
    color: #f8fafc;
    padding: 10px 12px;
    border-radius: var(--radius-sm);
    min-width: 180px;
    max-width: 240px;
    box-shadow: 0 10px 24px rgba(15, 23, 42, 0.4);
}

.map-token__tooltip-image {
    border-radius: var(--radius-sm);
    overflow: hidden;
}

.map-token__tooltip-image img {
    width: 100%;
    display: block;
}

.map-token__tooltip-body {
    display: grid;
    gap: 6px;
    font-size: 0.85rem;
}

.map-token__tooltip-name {
    font-weight: 700;
    letter-spacing: 0.02em;
}

.map-token__tooltip-stats {
    display: grid;
    gap: 2px;
    font-family: "JetBrains Mono", "Fira Code", "Menlo", monospace;
    font-size: 0.78rem;
}

.map-token__tooltip-notes {
    font-size: 0.78rem;
    line-height: 1.4;
    color: rgba(248, 250, 252, 0.9);
}

.map-token--player {
    border-color: rgba(56, 189, 248, 0.75);
}

.map-token--demon {
    border-color: rgba(249, 115, 22, 0.75);
}

.map-token--enemy {
    border-color: rgba(239, 68, 68, 0.75);
}

.map-board__overlay {
    position: absolute;
    inset: 0;
    display: grid;
    place-items: center;
    background: rgba(15, 23, 42, 0.55);
    padding: 24px;
    text-align: center;
}

.map-board__overlay-content {
    background: rgba(17, 24, 39, 0.85);
    border-radius: var(--radius);
    padding: 16px 20px;
    max-width: min(420px, 90%);
    color: #e5e7eb;
    display: grid;
    gap: 8px;
}

.map-sidebar {
    display: grid;
    gap: 16px;
}

.map-sidebar__tabs {
    display: grid;
    gap: 8px;
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
}

.map-sidebar__tab {
    border: 1px solid var(--border);
    border-radius: var(--radius-sm);
    padding: 8px 12px;
    background: var(--surface);
    color: var(--text);
    font-weight: 600;
    cursor: pointer;
    transition: background var(--trans-fast), border-color var(--trans-fast), color var(--trans-fast),
        box-shadow var(--trans-fast);
}

.map-sidebar__tab:focus-visible {
    outline: none;
    border-color: var(--brand);
    box-shadow: var(--focus);
}

.map-sidebar__tab:hover {
    border-color: var(--brand);
}

.map-sidebar__tab.is-active {
    background: rgba(59, 130, 246, 0.12);
    border-color: var(--brand);
    color: var(--brand-700);
    box-shadow: var(--focus);
}

.map-sidebar__content {
    display: grid;
    gap: 16px;
}

.map-accordion {
    border: 1px solid var(--border);
    border-radius: var(--radius);
    background: var(--surface);
    overflow: hidden;
}

.map-accordion__header {
    width: 100%;
    border: none;
    outline: none;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 12px;
    padding: 12px 16px;
    background: var(--surface-2);
    font-weight: 600;
    cursor: pointer;
    text-align: left;
    transition: background var(--trans-fast);
}

.map-accordion__icon {
    font-size: 14px;
    color: var(--muted);
}

.map-accordion.is-open .map-accordion__header {
    background: rgba(59, 130, 246, 0.08);
}

.map-accordion__description {
    margin: 0;
    padding: 0 16px 12px;
    color: var(--muted);
    font-size: 0.85rem;
}

.map-accordion__body {
    padding: 16px;
    display: grid;
    gap: 12px;
}

.map-token-form {
    display: grid;
    gap: 8px;
}

.map-token-form__controls {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
    align-items: center;
}

.map-token-list {
    list-style: none;
    margin: 0;
    padding: 0;
    display: grid;
    gap: 12px;
}

.map-token-list__item {
    display: flex;
    justify-content: space-between;
    gap: 12px;
    align-items: flex-start;
    padding: 12px 0;
    border-bottom: 1px solid var(--border);
}

.map-token-list__item:last-child {
    border-bottom: none;
}

.map-token-list__info {
    display: grid;
    gap: 4px;
    min-width: 0;
}

.map-token-list__actions {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
    align-items: center;
    justify-content: flex-end;
}

.map-enemy-form {
    display: grid;
    gap: 16px;
}

.map-enemy-form__section {
    display: grid;
    gap: 12px;
    padding: 16px;
    border: 1px solid var(--border);
    border-radius: var(--radius);
    background: var(--surface-2);
}

.map-enemy-form__section legend {
    font-weight: 600;
    padding: 0 6px;
}

.map-enemy-form__controls {
    display: flex;
    gap: 12px;
    align-items: center;
}

.map-enemy-form__controls--wrap {
    flex-wrap: wrap;
}

.map-enemy-form__detail {
    display: grid;
    gap: 8px;
}

.map-enemy-form__detail-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 12px;
}

.map-enemy-form__actions {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
    justify-content: flex-end;
}

.map-overlay-form {
    display: grid;
    gap: 12px;
}

.map-overlay-form__hint {
    margin: 0;
}

.map-overlay-form__grid {
    display: grid;
    gap: 12px;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
}

.map-overlay-form__control {
    display: grid;
    gap: 6px;
}

.map-overlay-form__control-inputs {
    display: grid;
    grid-template-columns: 1fr minmax(60px, 80px);
    gap: 8px;
    align-items: center;
}

.map-overlay-form__control-inputs input[type='number'] {
    width: 100%;
    padding: 6px 8px;
    border-radius: var(--radius-sm);
    border: 1px solid var(--border);
    background: var(--surface);
    font-size: 0.85rem;
}

.map-overlay-form__control-inputs input[type='number']:focus-visible {
    outline: none;
    box-shadow: var(--focus);
    border-color: color-mix(in oklab, var(--border) 30%, var(--brand) 70%);
}

.map-overlay-form__actions {
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
    align-items: center;
    justify-content: space-between;
}

.map-shape-buttons {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
}

.map-shape-list {
    display: grid;
    gap: 12px;
}

.map-shape-card {
    border: 1px solid var(--border);
    border-radius: var(--radius);
    background: var(--surface-2);
    padding: 16px;
    display: grid;
    gap: 12px;
}

.map-shape-card__header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 12px;
}

.map-shape-card__preview {
    width: 100%;
    max-height: 180px;
    border: 1px dashed var(--border);
    border-radius: var(--radius-sm);
    background: var(--surface);
    display: grid;
    place-items: center;
    overflow: hidden;
}

.map-shape-card__image {
    width: 100%;
    height: 100%;
    object-fit: contain;
    display: block;
}

.map-shape-card__body {
    display: grid;
    gap: 12px;
}

.map-shape-card__hint {
    margin: 0;
}

.map-shape-card__colors {
    display: flex;
    gap: 12px;
    flex-wrap: wrap;
}

.map-shape-card__controls {
    display: grid;
    gap: 10px;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
}

.map-shape-card__control {
    display: grid;
    gap: 6px;
}

.map-shape-card__control-inputs {
    display: grid;
    grid-template-columns: 1fr minmax(60px, 80px);
    gap: 8px;
    align-items: center;
}

.map-shape-card__control-inputs input[type='number'] {
    width: 100%;
    padding: 6px 8px;
    border-radius: var(--radius-sm);
    border: 1px solid var(--border);
    background: var(--surface);
    font-size: 0.85rem;
}

.map-shape-card__control-inputs input[type='number']:focus-visible {
    outline: none;
    box-shadow: var(--focus);
    border-color: color-mix(in oklab, var(--border) 30%, var(--brand) 70%);
}

.map-shape-card__actions {
    display: flex;
    justify-content: flex-end;
    gap: 8px;
}

.map-library-actions {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
    align-items: center;
}

.map-library-list {
    display: grid;
    gap: 12px;
}

.map-library-row__actions {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
}

.map-panel {
    display: grid;
    gap: 12px;
}

.map-background-controls,
.map-shape-row__controls {
    display: grid;
    gap: 8px;
}

.map-background-slider,
.map-shape-slider {
    display: grid;
    gap: 4px;
}

.map-background-slider input[type="range"],
.map-shape-slider input[type="range"] {
    width: 100%;
}

.map-panel__add {
    display: grid;
    gap: 8px;
}

.map-shape-row {
    display: grid;
    gap: 12px;
    padding: 10px 0;
    border-bottom: 1px solid var(--border);
}

.map-shape-row:last-child {
    border-bottom: none;
}

.map-shape-row__header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 12px;
}

.map-library-row {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 12px;
    padding: 10px 0;
    border-bottom: 1px solid var(--border);
}

.map-library-row:last-child {
    border-bottom: none;
}

.map-library-row__info {
    display: grid;
    gap: 4px;
}

.map-library-row__preview {
    word-break: break-all;
    color: var(--muted);
}

.map-token-row {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 12px;
    padding: 10px 0;
    border-bottom: 1px solid var(--border);
}

.map-token-row:last-child {
    border-bottom: none;
}

.map-empty {
    margin: 4px 0 0;
}


.settings-card {
    display: grid;
    gap: 16px;
}

.settings-tabs {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
}

.settings-tab {
    border: 1px solid var(--border);
    background: var(--surface-2);
    color: var(--text);
    padding: 6px 14px;
    border-radius: 999px;
    font-weight: 600;
    cursor: pointer;
    transition: background var(--trans-fast), color var(--trans-fast), border-color var(--trans-fast);
}

.settings-tab:hover {
    border-color: var(--brand);
}

.settings-tab.is-active {
    background: var(--brand);
    color: #ffffff;
    border-color: var(--brand);
    box-shadow: var(--shadow-sm);
}

.settings-tab:focus-visible {
    outline: none;
    box-shadow: var(--focus);
}

.settings-content {
    display: grid;
    gap: 16px;
}

/* Gear overview */
.gear-overview-card {
    display: grid;
    gap: 12px;
}

.gear-overview-card__header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    flex-wrap: wrap;
    gap: 12px;
}

.gear-overview-card__sub {
    opacity: 0.7;
    font-size: 12px;
}

.gear-overview-card__stats {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
}

.gear-card-grid {
    display: grid;
    gap: 16px;
    grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
}

.gear-slot-card {
    background: var(--surface-2);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 12px;
    display: flex;
    flex-direction: column;
    gap: 12px;
    min-height: 220px;
}

.gear-slot-card__header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 10px;
}

.gear-slot-card__index {
    font-weight: 700;
    color: var(--brand-600);
}

.gear-slot-card__title-group {
    display: flex;
    gap: 8px;
    align-items: center;
    flex-wrap: wrap;
}

.gear-slot-card__title {
    font-weight: 600;
}

.gear-slot-card__body {
    display: grid;
    gap: 6px;
}

.gear-slot-card__name {
    font-weight: 600;
}

.gear-slot-card__desc {
    font-size: 12px;
    opacity: 0.75;
}

.gear-slot-card__empty {
    font-size: 12px;
    opacity: 0.65;
}

.gear-slot-card__queued {
    font-size: 12px;
    color: var(--brand-700);
}

.gear-slot-card__controls {
    display: grid;
    gap: 6px;
}

.gear-slot-card__controls select {
    width: 100%;
    min-height: 34px;
}

.gear-slot-card__hint {
    margin: 0;
    font-size: 11px;
}

.gear-slot-card--empty {
    display: flex;
    align-items: center;
    justify-content: center;
}

/* Gear stash */
.gear-stash-card {
    display: grid;
    gap: 12px;
}

.gear-stash-card__header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 12px;
    flex-wrap: wrap;
}

.gear-stash-card__sub {
    font-size: 12px;
    opacity: 0.7;
}

.gear-stash-actions {
    display: grid;
    gap: 12px;
}

.gear-stash-form {
    display: grid;
    gap: 8px;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    align-items: end;
}

.gear-stash-form textarea {
    resize: vertical;
}

.gear-stash-row {
    display: flex;
    flex-direction: column;
    gap: 10px;
    padding: 12px;
    border: 1px solid var(--border);
    border-radius: var(--radius-sm);
    background: var(--surface-2);
}

@media (min-width: 640px) {
    .gear-stash-row {
        flex-direction: row;
        justify-content: space-between;
        align-items: flex-start;
    }
}

.gear-stash-row__title {
    display: flex;
    gap: 6px;
    flex-wrap: wrap;
    align-items: center;
}

.gear-stash-row__desc {
    font-size: 12px;
    opacity: 0.75;
}

.gear-stash-row__actions {
    display: grid;
    gap: 8px;
    min-width: 220px;
}

.gear-inventory-stack {
    display: grid;
    gap: 16px;
}

/* Help tab */
.help-layout {
    display: flex;
    gap: 20px;
    align-items: flex-start;
    flex-wrap: wrap;
}

.help-sidebar {
    flex: 1 1 260px;
    max-width: 320px;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 16px;
    box-shadow: var(--shadow-sm);
}

.help-list {
    list-style: none;
    padding: 0;
    margin: 12px 0 0;
    display: grid;
    gap: 8px;
}

.help-link {
    width: 100%;
    text-align: left;
    background: var(--surface-2);
    border: 1px solid var(--border);
    border-radius: var(--radius-sm);
    padding: 8px 10px;
    cursor: pointer;
    font-weight: 600;
    color: var(--text);
    transition: background var(--trans-fast), border-color var(--trans-fast);
}

.help-link:hover {
    border-color: var(--brand-600);
}

.help-link.active {
    border-color: var(--brand);
    background: color-mix(in oklab, var(--brand) 8%, var(--surface));
    color: var(--brand-700);
}

.help-content {
    flex: 3 1 400px;
    min-width: 260px;
    display: grid;
    gap: 12px;
}

.help-doc {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 16px;
    box-shadow: var(--shadow-sm);
    display: grid;
    gap: 12px;
}

.help-doc__header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 12px;
    flex-wrap: wrap;
}

.help-doc__body {
    margin: 0;
    white-space: pre-wrap;
    font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;
    font-size: 0.85rem;
    background: var(--surface-2);
    border: 1px solid var(--border);
    border-radius: var(--radius-sm);
    padding: 12px;
    max-height: 60vh;
    overflow: auto;
}

.help-empty {
    background: var(--surface);
    border: 1px dashed var(--border);
    border-radius: var(--radius);
    padding: 24px;
    color: var(--muted);
}

.help-error {
    color: var(--danger);
    font-weight: 600;
}

/* Application shell */
.app-root {
    display: grid;
    gap: 16px;
}

.app-activity {
    height: 3px;
    border-radius: 999px;
    background: var(--border);
    overflow: hidden;
    position: relative;
    opacity: 0;
    transition: opacity var(--trans-fast);
}

.app-activity__bar {
    position: absolute;
    inset: 0;
    background: linear-gradient(90deg, var(--brand-600), var(--brand));
    transform-origin: left;
    transform: scaleX(0);
    transition: transform var(--trans-fast);
}

.app-activity.is-active {
    opacity: 1;
}

.app-activity.is-active .app-activity__bar {
    transform: scaleX(1);
    animation: activity-pulse 1.2s ease-in-out infinite;
}

@keyframes activity-pulse {
    from { opacity: 0.45; }
    to { opacity: 1; }
}

.app-shell {
    position: relative;
    display: grid;
    grid-template-columns: minmax(260px, 320px) minmax(0, 1fr);
    gap: 28px;
    min-height: calc(100vh - clamp(16px, 3vw, 32px) * 2);
    transition: grid-template-columns var(--trans-fast);
}

.app-shell.is-sidebar-collapsed {
    grid-template-columns: minmax(0, 1fr);
}

.app-shell.is-sidebar-collapsed .app-sidebar {
    opacity: 0;
    transform: translateX(-32px);
    pointer-events: none;
}

.app-shell.is-sidebar-collapsed .app-main {
    grid-column: 1 / -1;
}

.app-shell.is-sidebar-open .app-sidebar {
    opacity: 1;
    transform: translateX(0);
}

@media (max-width: 960px) {
    .app-shell {
        grid-template-columns: minmax(0, 1fr);
    }

    .app-shell::after {
        content: "";
        position: fixed;
        inset: 0;
        background: rgba(4, 10, 16, 0.35);
        opacity: 0;
        visibility: hidden;
        pointer-events: none;
        transition: opacity var(--trans-fast), visibility var(--trans-fast);
        z-index: 300;
    }

    .app-shell.is-sidebar-open::after {
        opacity: 1;
        visibility: visible;
    }

    .app-sidebar {
        position: fixed;
        top: clamp(16px, 3vw, 32px);
        left: clamp(16px, 3vw, 32px);
        bottom: clamp(16px, 3vw, 32px);
        max-width: 320px;
        width: min(320px, calc(100% - clamp(16px, 3vw, 32px) * 2));
        transform: translateX(-24px);
        opacity: 0;
        pointer-events: none;
        z-index: 350;
    }

    .app-shell.is-sidebar-open .app-sidebar {
        opacity: 1;
        transform: translateX(0);
        pointer-events: auto;
    }
}

.app-sidebar {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-md);
    padding: 28px 22px;
    display: flex;
    flex-direction: column;
    gap: 24px;
    transition: transform var(--trans-fast), opacity var(--trans-fast), box-shadow var(--trans-fast);
}

.app-sidebar .btn {
    width: 100%;
}

.sidebar__header {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    gap: 16px;
}

.sidebar__header-main {
    display: grid;
    gap: 6px;
    flex: 1 1 auto;
    min-width: 0;
}

.sidebar__close {
    display: none;
    align-items: center;
    justify-content: center;
    width: 36px;
    height: 36px;
    border-radius: 50%;
    border: 1px solid var(--border);
    background: var(--surface-2);
    color: var(--muted);
    font-size: 1.2rem;
    line-height: 1;
    cursor: pointer;
    transition: background var(--trans-fast), border-color var(--trans-fast), color var(--trans-fast);
}

.sidebar__close:hover {
    background: color-mix(in oklab, var(--surface-2) 70%, var(--brand) 15%);
    border-color: color-mix(in oklab, var(--border) 55%, var(--brand) 25%);
    color: var(--text);
}

.sidebar__close:focus-visible {
    outline: none;
    box-shadow: var(--focus);
}

@media (max-width: 960px) {
    .sidebar__close {
        display: inline-flex;
    }
}

.sidebar__mode {
    font-size: .72rem;
    letter-spacing: .18em;
    text-transform: uppercase;
    color: var(--brand-600);
    font-weight: 700;
}

.sidebar__title {
    margin: 4px 0;
}

.sidebar__summary {
    color: var(--muted);
    font-size: .9rem;
    line-height: 1.45;
    margin: 0;
}

.sidebar__nav {
    display: grid;
    gap: 8px;
}

.sidebar__nav-button {
    text-align: left;
    border-radius: var(--radius);
    padding: 14px 16px;
    background: transparent;
    border: 1px solid transparent;
    display: grid;
    gap: 4px;
    color: var(--muted);
    font-size: .92rem;
    transition:
        background var(--trans-fast),
        border-color var(--trans-fast),
        color var(--trans-fast),
        transform var(--trans-fast),
        box-shadow var(--trans-fast);
}

.sidebar__nav-button:hover {
    background: var(--surface-2);
    border-color: var(--border);
    color: var(--text);
}

.sidebar__nav-button.is-active {
    background: color-mix(in oklab, var(--brand) 8%, var(--surface));
    border-color: color-mix(in oklab, var(--brand) 45%, transparent);
    box-shadow: var(--shadow-sm);
    color: var(--text);
}

.sidebar__nav-label {
    font-weight: 600;
}

.sidebar__nav-desc {
    font-size: .78rem;
    color: var(--muted);
    line-height: 1.4;
}

.sidebar__audio-panel {
    margin: 24px 16px 0;
    padding: 12px;
    border-radius: var(--radius);
    border: 1px solid var(--border);
    background: var(--surface-2);
    display: grid;
    gap: 10px;
}

.sidebar__audio-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 8px;
}

.sidebar__audio-title {
    font-weight: 600;
    font-size: 0.9rem;
}

.sidebar__audio-controls {
    display: grid;
    grid-template-columns: auto 1fr auto;
    gap: 8px;
    align-items: center;
}

.sidebar__audio-controls input[type="range"] {
    width: 100%;
}

.sidebar__audio-volume {
    font-size: 0.8rem;
    color: var(--muted);
    min-width: 3ch;
    text-align: right;
}

.sidebar__audio-track {
    font-size: 0.85rem;
    color: var(--muted);
}

.sidebar__audio-track strong {
    color: var(--text);
}

.sidebar__footer {
    margin-top: auto;
    display: grid;
    gap: 12px;
}

.sidebar__player-info {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 12px;
    padding: 14px 16px;
    border-radius: var(--radius);
    background: color-mix(in oklab, var(--brand) 10%, var(--surface));
    border: 1px solid color-mix(in oklab, var(--brand) 40%, var(--border));
    box-shadow: var(--shadow-sm);
}

.sidebar__player-label {
    font-size: 0.72rem;
    text-transform: uppercase;
    letter-spacing: 0.22em;
    color: var(--brand-600);
    font-weight: 700;
}

.sidebar__player-value {
    font-size: 1.15rem;
    font-weight: 700;
}

.app-sidebar .invite-button {
    width: 100%;
    align-items: stretch;
    text-align: left;
}

.app-sidebar .invite-button > .btn {
    width: 100%;
    justify-content: center;
}

.app-sidebar .invite-feedback {
    width: 100%;
}

.app-main {
    display: flex;
    flex-direction: column;
    gap: 24px;
}

.app-main__header {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius-lg);
    padding: 24px;
    box-shadow: var(--shadow-sm);
    display: flex;
    justify-content: space-between;
    gap: 24px;
    align-items: flex-start;
    position: relative;
    z-index: 350;
}

.header-leading {
    display: flex;
    align-items: flex-start;
    gap: 16px;
}

@media (max-width: 720px) {
    .header-leading {
        flex-direction: column;
        align-items: stretch;
    }
}

@media (max-width: 720px) {
    .app-main__header {
        flex-direction: column;
    }
}

.eyebrow {
    display: inline-block;
    font-size: .72rem;
    letter-spacing: .18em;
    text-transform: uppercase;
    color: var(--brand-600);
    font-weight: 700;
    margin-bottom: 6px;
}

.text-muted { color: var(--muted); }
.text-small { font-size: .85rem; line-height: 1.4; }
.text-tiny { font-size: .75rem; line-height: 1.2; color: var(--muted); }
.text-error { color: var(--danger); }

.app-main__header-meta {
    display: grid;
    gap: 12px;
    justify-items: end;
}

.header-actions {
    display: flex;
    align-items: center;
    gap: 8px;
    flex-wrap: wrap;
    justify-content: flex-end;
}

.header-actions .btn {
    white-space: nowrap;
}

.hotkey-hint {
    opacity: 0.75;
}

.sidebar-toggle {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 10px 14px;
    border-radius: var(--radius);
    border: 1px solid var(--border);
    background: var(--surface-2);
    color: var(--text);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    cursor: pointer;
    transition: background var(--trans-fast), border-color var(--trans-fast), color var(--trans-fast), transform var(--trans-fast);
}

.sidebar-toggle:hover {
    background: color-mix(in oklab, var(--surface-2) 60%, var(--brand) 10%);
    border-color: color-mix(in oklab, var(--border) 50%, var(--brand) 25%);
}

.sidebar-toggle:focus-visible {
    outline: none;
    box-shadow: var(--focus);
}

.sidebar-toggle.is-closed {
    background: var(--brand);
    border-color: color-mix(in oklab, var(--brand) 60%, transparent);
    color: #fff;
}

.sidebar-toggle.is-closed:hover {
    background: var(--brand-600);
}

.sidebar-toggle__icon {
    font-size: 1.1rem;
    line-height: 1;
}

.sidebar-toggle__label {
    font-size: 0.78rem;
}

.header-pills {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    justify-content: flex-end;
}

.header-metrics {
    display: flex;
    flex-wrap: wrap;
    gap: 16px;
    justify-content: flex-end;
}

.header-metric {
    display: grid;
    gap: 2px;
    text-align: right;
}

.header-metric strong {
    font-size: 1rem;
}

.app-content {
    display: grid;
    gap: 20px;
}

.profile-tab {
    display: grid;
    gap: 20px;
    max-width: 640px;
}

.profile-tab__card {
    display: grid;
    gap: 16px;
}

.profile-tab__header {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    gap: 16px;
    flex-wrap: wrap;
}

.profile-tab__header h3 {
    margin: 0;
    font-size: 1.5rem;
    font-weight: 700;
}

.profile-tab__macca {
    display: grid;
    gap: 4px;
    text-align: right;
}

.profile-tab__macca-value {
    font-size: 2rem;
    font-weight: 700;
    line-height: 1.1;
}

.profile-tab__details {
    display: grid;
    gap: 12px;
    margin: 0;
}

.profile-tab__details-item {
    display: grid;
    grid-template-columns: minmax(0, 160px) minmax(0, 1fr);
    gap: 12px;
    align-items: baseline;
}

.profile-tab__details-item dt {
    font-size: 0.75rem;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: var(--muted);
    margin: 0;
}

.profile-tab__details-item dd {
    margin: 0;
    font-size: 1rem;
    font-weight: 600;
    color: var(--text);
}

@media (max-width: 640px) {
    .profile-tab__details-item {
        grid-template-columns: 1fr;
        gap: 4px;
    }

    .profile-tab__macca {
        text-align: left;
        justify-items: flex-start;
    }
}

/* Story logs */
.story-logs-card {
    display: grid;
    gap: 16px;
}

.story-logs__actions {
    display: flex;
    gap: 8px;
    align-items: center;
    justify-content: flex-end;
    flex-wrap: wrap;
}

.story-logs__status {
    display: flex;
    gap: 12px;
    align-items: center;
    flex-wrap: wrap;
    font-size: 0.85rem;
}

.story-logs__status-name {
    font-weight: 600;
}

.story-logs__persona-statuses {
    display: grid;
    gap: 8px;
    margin-top: 8px;
}

.story-logs__persona-status {
    border-radius: var(--radius-sm);
    border: 1px solid var(--border);
    background: color-mix(in srgb, var(--surface) 94%, transparent);
    padding: 8px 10px;
    font-size: 0.85rem;
}

.story-logs__persona-status--pending {
    border-color: color-mix(in srgb, var(--brand) 40%, var(--border));
    background: color-mix(in srgb, var(--brand) 12%, transparent);
}

.story-logs__persona-status--approved {
    border-color: color-mix(in srgb, var(--success) 40%, var(--border));
    background: color-mix(in srgb, var(--success) 12%, transparent);
}

.story-logs__persona-status--denied {
    border-color: color-mix(in srgb, var(--danger) 40%, var(--border));
    background: color-mix(in srgb, var(--danger) 12%, transparent);
}

.story-logs__persona-status--expired {
    border-color: color-mix(in srgb, var(--muted) 35%, var(--border));
    background: color-mix(in srgb, var(--muted) 10%, transparent);
}

.story-logs__persona-status-text {
    display: block;
}

.story-logs__alert {
    padding: 12px 14px;
    border-radius: var(--radius-sm);
    border: 1px solid color-mix(in srgb, var(--danger) 35%, transparent);
    background: color-mix(in srgb, var(--danger) 12%, transparent);
}

.story-logs__body {
    display: grid;
    gap: 12px;
}

.story-logs__topic {
    margin: 0;
    font-size: 0.85rem;
    white-space: pre-wrap;
}

.story-logs__messages {
    display: grid;
    gap: 16px;
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 16px;
    background: color-mix(in srgb, var(--surface) 92%, transparent);
    max-height: clamp(420px, 70vh, 760px);
    overflow-y: auto;
}

.story-logs__message {
    display: grid;
    grid-template-columns: auto 1fr;
    gap: 12px;
}

.story-logs__avatar {
    width: 44px;
    height: 44px;
    border-radius: 50%;
    overflow: hidden;
    background: color-mix(in srgb, var(--surface-2) 85%, transparent);
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
}

.story-logs__avatar img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
}

.story-logs__message-body {
    display: grid;
    gap: 8px;
}

.story-logs__message-header {
    display: flex;
    gap: 12px;
    align-items: flex-start;
    justify-content: space-between;
    flex-wrap: wrap;
}

.story-logs__message-meta {
    display: flex;
    gap: 8px;
    align-items: baseline;
    flex-wrap: wrap;
}

.story-logs__author {
    font-weight: 600;
}

.story-logs__timestamp {
    font-size: 0.75rem;
    color: var(--muted);
}

.story-logs__message-text {
    margin: 0;
    white-space: pre-wrap;
    word-break: break-word;
}

.story-logs__markdown {
    display: grid;
    gap: 8px;
    font-size: 0.95rem;
    line-height: 1.5;
    word-break: break-word;
}

.story-logs__markdown p,
.story-logs__markdown ul,
.story-logs__markdown ol,
.story-logs__markdown blockquote {
    margin: 0;
}

.story-logs__markdown ul,
.story-logs__markdown ol {
    padding-left: 20px;
    display: grid;
    gap: 4px;
}

.story-logs__markdown pre {
    margin: 0;
    padding: 10px 12px;
    border-radius: var(--radius-sm);
    border: 1px solid var(--border);
    background: color-mix(in srgb, var(--surface-2) 88%, transparent);
    font-size: 0.85rem;
    overflow-x: auto;
}

.story-logs__markdown code {
    background: color-mix(in srgb, var(--surface-2) 85%, transparent);
    padding: 2px 4px;
    border-radius: 4px;
    font-size: 0.85rem;
}

.story-logs__markdown pre code {
    background: none;
    padding: 0;
}

.story-logs__markdown blockquote {
    border-left: 3px solid color-mix(in srgb, var(--border) 70%, transparent);
    padding-left: 12px;
    color: var(--muted);
    display: grid;
    gap: 6px;
}

.story-logs__markdown a {
    color: var(--brand);
}

.story-logs__markdown del {
    color: var(--muted);
}

.story-logs__delete {
    border: none;
    background: none;
    color: var(--muted);
    font-size: 0.75rem;
    padding: 4px 8px;
    border-radius: var(--radius-sm);
    cursor: pointer;
    transition: color var(--trans), background var(--trans);
}

.story-logs__delete:hover {
    color: var(--danger);
    background: color-mix(in srgb, var(--danger) 12%, transparent);
}

.story-logs__delete:focus {
    outline: none;
    box-shadow: var(--focus);
}

.story-logs__delete:disabled {
    opacity: 0.6;
    cursor: default;
}

.story-logs__attachments {
    list-style: none;
    margin: 0;
    padding: 0;
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
}

.story-logs__attachments li {
    margin: 0;
}

.story-logs__attachments a {
    font-size: 0.85rem;
}

.story-logs__composer {
    display: grid;
    gap: 8px;
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 12px;
    background: color-mix(in srgb, var(--surface) 90%, transparent);
}

.story-logs__composer-row {
    display: flex;
    gap: 8px;
    align-items: center;
    flex-wrap: wrap;
}

.story-logs__composer select {
    min-width: 160px;
}

.story-logs__composer textarea {
    width: 100%;
    min-height: 72px;
    resize: vertical;
}

.story-logs__composer-footer {
    display: flex;
    gap: 8px;
    align-items: center;
    justify-content: space-between;
    flex-wrap: wrap;
}

.story-logs__composer-footer .btn {
    margin-left: auto;
}

.story-logs__image-link {
    display: inline-block;
    max-width: 100%;
}

.story-logs__image {
    display: block;
    max-width: min(360px, 100%);
    border-radius: var(--radius-sm);
    border: 1px solid color-mix(in srgb, var(--border) 60%, transparent);
    box-shadow: 0 2px 8px color-mix(in srgb, black 8%, transparent);
}

.story-logs__message-footer {
    font-size: 0.85rem;
}

.story-logs__empty {
    padding: 24px;
    border: 1px dashed color-mix(in srgb, var(--border) 75%, transparent);
    border-radius: var(--radius);
    background: color-mix(in srgb, var(--surface) 85%, transparent);
}

.story-logs__empty p {
    margin: 0;
}

@media (max-width: 960px) {
    .app-sidebar {
        border-radius: var(--radius);
        padding: 24px 20px;
    }

    .app-main__header-meta {
        justify-items: start;
    }

    .header-pills {
        justify-content: flex-start;
    }
}

/* Party list */
.party-roster {
    display: grid;
    gap: 12px;
}

.party-row {
    background: var(--surface-2);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 12px 16px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 16px;
    transition:
        background var(--trans-fast),
        border-color var(--trans-fast),
        box-shadow var(--trans-fast),
        transform var(--trans-fast);
}

.party-row__info {
    display: grid;
    gap: 4px;
    min-width: 0;
}

.party-row__name {
    font-weight: 600;
    font-size: 1rem;
    overflow: hidden;
    text-overflow: ellipsis;
}

.party-row__metrics {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    align-items: center;
    justify-content: flex-end;
}

.party-row.is-clickable {
    cursor: pointer;
}

.party-row.is-clickable:hover {
    border-color: color-mix(in oklab, var(--brand) 45%, transparent);
    background: color-mix(in oklab, var(--brand) 6%, var(--surface));
}

.party-row.is-active {
    border-color: color-mix(in oklab, var(--brand) 55%, transparent);
    background: color-mix(in oklab, var(--brand) 10%, var(--surface));
    box-shadow: var(--shadow-sm);
}

.party-row:focus-visible {
    outline: none;
    box-shadow: var(--focus);
}

@media (max-width: 640px) {
    .party-row {
        flex-direction: column;
        align-items: flex-start;
    }

    .party-row__metrics {
        justify-content: flex-start;
    }
}

/* DM overview */
.dm-overview {
    gap: 20px;
}

.dm-broadcast__form {
    display: grid;
    gap: 8px;
}

.dm-broadcast__form .row.wrap {
    align-items: stretch;
}

.dm-broadcast__form input {
    flex: 1 1 240px;
    min-width: 180px;
}

.dm-broadcast__now-playing {
    color: var(--muted);
    word-break: break-word;
}

.dm-broadcast__now-playing a {
    color: var(--brand);
    text-decoration: none;
}

.dm-broadcast__now-playing a:hover {
    text-decoration: underline;
}

.overview-metrics {
    display: grid;
    gap: 12px;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
}

.metric-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 16px;
    display: grid;
    gap: 6px;
    box-shadow: var(--shadow-sm);
}

.metric-card__value {
    font-size: 1.6rem;
    font-weight: 700;
}

.overview-roster {
    gap: 12px;
}

.overview-player {
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
    gap: 16px;
    align-items: center;
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 14px 16px;
    background: var(--surface-2);
    transition:
        background var(--trans-fast),
        border-color var(--trans-fast),
        box-shadow var(--trans-fast),
        transform var(--trans-fast);
}

.overview-player__info {
    display: grid;
    gap: 4px;
    min-width: 0;
}

.overview-player__name {
    font-weight: 600;
    font-size: 1.05rem;
}

.overview-player__meta {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    align-items: center;
    justify-content: flex-end;
}

.presence-indicator {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 4px 10px;
    border-radius: 999px;
    border: 1px solid var(--border);
    background: var(--surface);
    font-size: 0.75rem;
    font-weight: 600;
    letter-spacing: 0.02em;
    text-transform: uppercase;
    color: var(--muted);
    white-space: nowrap;
}

.presence-indicator::before {
    content: "";
    width: 8px;
    height: 8px;
    border-radius: 999px;
    background: var(--border);
    box-shadow: 0 0 0 1px var(--border);
}

.presence-indicator.is-online {
    border-color: color-mix(in oklab, var(--success) 55%, transparent);
    background: color-mix(in oklab, var(--success) 12%, var(--surface-2));
    color: color-mix(in oklab, var(--success) 65%, var(--text));
}

.presence-indicator.is-online::before {
    background: var(--success);
    box-shadow: 0 0 0 1px color-mix(in oklab, var(--success) 45%, transparent);
}

.presence-indicator.is-offline::before {
    background: var(--border);
    box-shadow: 0 0 0 1px var(--border);
}

.overview-player.is-clickable {
    cursor: pointer;
}

.overview-player.is-clickable:hover {
    border-color: color-mix(in oklab, var(--brand) 45%, transparent);
    background: color-mix(in oklab, var(--brand) 6%, var(--surface));
}

.overview-player:focus-visible {
    outline: none;
    box-shadow: var(--focus);
}

.overview-resources {
    display: flex;
    flex-direction: column;
    gap: 16px;
}

.resource-grid {
    display: grid;
    gap: 12px;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
}

.resource-chip {
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 14px 16px;
    display: grid;
    gap: 4px;
    background: var(--surface-2);
    box-shadow: var(--shadow-sm);
}

.resource-chip strong {
    font-size: 1.3rem;
}

.shared-media {
    position: fixed;
    bottom: 24px;
    right: 24px;
    width: min(420px, calc(100vw - 32px));
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    box-shadow: var(--shadow-md);
    z-index: 1200;
}

.shared-media__header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 8px;
    padding: 12px 16px;
    border-bottom: 1px solid var(--border);
}

.shared-media__actions {
    display: flex;
    gap: 8px;
}

.shared-media__body {
    display: grid;
    gap: 12px;
    padding: 12px 16px 16px;
}

.shared-media__body--compact {
    gap: 8px;
}

.shared-media__track {
    font-size: 0.95rem;
}

.shared-media__player {
    aspect-ratio: 16 / 9;
    background: #000;
    border-radius: var(--radius-sm);
    overflow: hidden;
}

.shared-media__player iframe {
    width: 100%;
    height: 100%;
    border: 0;
}

.shared-media__footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 12px;
}

.shared-media__links a {
    color: var(--brand);
    font-weight: 600;
    text-decoration: none;
}

.shared-media__links a:hover {
    text-decoration: underline;
}

.shared-media.is-collapsed .shared-media__body {
    display: none;
}

.shared-media.is-collapsed .shared-media__header {
    border-bottom: none;
}

.alert-overlay {
    position: fixed;
    top: 24px;
    right: 24px;
    display: flex;
    flex-direction: column;
    gap: 12px;
    width: min(320px, calc(100vw - 32px));
    z-index: 1250;
}

.alert-toast {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    box-shadow: var(--shadow-md);
    padding: 12px 16px;
    display: grid;
    gap: 8px;
}

.alert-toast__header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 8px;
}

.alert-toast p {
    margin: 0;
}

@media (max-width: 720px) {
    .shared-media {
        left: 16px;
        right: 16px;
        width: auto;
    }

    .alert-overlay {
        left: 16px;
        right: 16px;
        width: auto;
    }
}

@media (max-width: 640px) {
    .overview-player {
        flex-direction: column;
        align-items: flex-start;
    }

    .overview-player__meta {
        justify-content: flex-start;
    }
}

/* Pills / badges */
.pill {
    background: #e5e7eb;
    color: #111827;
    padding: 2px 8px;
    border-radius: 9999px;
    font-size: 12px;
    line-height: 20px;
    border: 1px solid var(--border);
}
@media (prefers-color-scheme: dark) {
    .pill {
        background: #1f2937;
        color: #e5e7eb;
    }
}
.pill.success { background: color-mix(in oklab, var(--success) 20%, transparent); color: var(--text); }
.pill.warn    { background: color-mix(in oklab, var(--warning) 25%, transparent); color: var(--text); }
.pill.danger  { background: color-mix(in oklab, var(--danger) 20%, transparent); color: var(--text); }
.pill.light   { background: color-mix(in srgb, var(--brand) 12%, transparent); color: var(--brand-600); border: none; }

/* Inputs */
input, select, textarea {
    width: 100%;
    padding: 10px 12px;
    border-radius: var(--radius-sm);
    border: 1px solid var(--border);
    background: var(--surface);
    color: var(--text);
    transition: border-color var(--trans-fast), box-shadow var(--trans-fast), background var(--trans-fast);
}
input::placeholder, textarea::placeholder {
    color: var(--muted);
}
input:focus, select:focus, textarea:focus {
    outline: none;
    border-color: var(--brand);
    box-shadow: var(--focus);
    background: var(--surface);
}
input[readonly] {
    opacity: .85;
}

.input-error {
    border-color: var(--danger);
    box-shadow: 0 0 0 1px color-mix(in oklab, var(--danger) 35%, transparent);
}

label {
    font-size: 12px;
    color: var(--muted);
    font-weight: 600;
    letter-spacing: .2px;
}

.perm-toggle {
    display: flex;
    gap: 12px;
    align-items: flex-start;
    padding: 12px;
    border: 1px solid var(--border);
    border-radius: var(--radius-sm);
    background: var(--surface-2);
    transition: border-color var(--trans-fast), box-shadow var(--trans-fast);
}

.perm-toggle:hover {
    border-color: var(--brand);
    box-shadow: var(--focus);
}

.perm-toggle input {
    margin-top: 4px;
}

.perm-toggle__text {
    display: grid;
    gap: 4px;
}

.story-callout {
    border: 1px dashed var(--border);
    background: var(--surface-2);
    padding: 16px;
    border-radius: var(--radius);
    display: grid;
    gap: 12px;
}

.story-callout__grid {
    display: grid;
    gap: 8px;
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
}

.story-callout__label {
    display: block;
    font-size: 0.75rem;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: var(--muted);
    margin-bottom: 2px;
}

.story-callout code {
    font-size: 0.85rem;
}

/* Character sheet layout */
.sheet-card { display: grid; gap: 24px; }
.sheet-header { display: flex; justify-content: space-between; align-items: flex-start; gap: 16px; }
.sheet-header__actions { display: flex; gap: 8px; flex-wrap: wrap; }
.sheet-toolbar { display: flex; flex-wrap: wrap; gap: 12px; }
.sheet-section { display: grid; gap: 16px; }
.sheet-section.is-collapsed .section-body { display: none; }
.sheet-spotlight {
    display: grid;
    gap: 16px;
    border: 1px solid var(--border);
    border-radius: var(--radius);
    background: var(--surface-2);
    padding: 16px;
}
.sheet-spotlight__top {
    display: flex;
    flex-wrap: wrap;
    gap: 16px;
    align-items: flex-start;
}
.sheet-spotlight__identity {
    flex: 1 1 240px;
    display: grid;
    gap: 4px;
}
.sheet-spotlight__identity h2 { margin: 0; font-size: clamp(1.4rem, 1.1rem + 1vw, 1.8rem); }
.sheet-spotlight__meta { margin: 0; color: var(--muted); font-size: 0.85rem; }
.sheet-spotlight__stats { display: grid; gap: 12px; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); }
.sheet-spotlight__stat { background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius-sm); padding: 12px; display: grid; gap: 6px; }
.sheet-spotlight__stat-label { font-size: 0.7rem; letter-spacing: 0.06em; text-transform: uppercase; color: var(--muted); font-weight: 600; }
.sheet-spotlight__stat-value { font-size: 1.2rem; font-weight: 700; display: flex; gap: 4px; align-items: baseline; }
.sheet-spotlight__stat-extra { font-size: 0.85rem; color: var(--muted); }
.sheet-spotlight__stat-detail { font-size: 0.75rem; color: var(--muted); }
.sheet-spotlight__notes { margin: 0; }
.sheet-portrait {
    flex: 0 0 220px;
    max-width: 220px;
    display: grid;
    gap: 8px;
}
.sheet-portrait__frame {
    width: 100%;
    aspect-ratio: 3 / 4;
    border: 1px solid var(--border);
    border-radius: var(--radius);
    background: var(--surface);
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    padding: 8px;
    text-align: center;
    color: var(--muted);
    font-size: 0.85rem;
}
.sheet-portrait__image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: calc(var(--radius) - 2px);
}
.sheet-portrait__actions { display: flex; flex-wrap: wrap; gap: 8px; }
.sheet-portrait__placeholder { padding: 8px; }
.sheet-portrait__error {
    margin: 0;
    font-size: 0.8rem;
}

@media (max-width: 600px) {
    .sheet-portrait {
        flex-basis: 100%;
        max-width: 100%;
    }
    .sheet-portrait__frame {
        aspect-ratio: 16 / 9;
    }
}
.section-header {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    gap: 12px;
    width: 100%;
    padding: 4px 0;
    border: none;
    background: none;
    color: inherit;
    font: inherit;
    text-align: left;
    cursor: pointer;
}
.section-header:focus-visible {
    outline: none;
    box-shadow: var(--focus);
    border-radius: var(--radius-sm);
}
.section-header:hover .section-header__icon {
    color: var(--brand-600);
}
.section-header__text { display: grid; gap: 4px; }
.section-header__icon {
    font-size: 1.2rem;
    line-height: 1;
    color: var(--muted);
    transition: transform var(--trans-fast), color var(--trans-fast);
}
.sheet-section.is-collapsed .section-header__icon { transform: rotate(-90deg); }
.section-body { display: grid; gap: 16px; }
.sheet-grid { display: grid; gap: 12px; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); }
.sheet-grid--stretch { grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); }
.sheet-grid--resources { grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); }
.field { display: flex; flex-direction: column; gap: 6px; font-size: 0.95rem; }
.field__label { font-size: 0.7rem; font-weight: 600; letter-spacing: 0.06em; text-transform: uppercase; color: var(--muted); }
.field input,
.field select,
.field textarea { font: inherit; }
.field textarea { min-height: 96px; resize: vertical; }
.field input:disabled,
.field select:disabled,
.field textarea:disabled { opacity: 0.6; cursor: not-allowed; }
.sheet-hints { display: flex; flex-wrap: wrap; gap: 12px; }
.sheet-hint { border: 1px solid var(--border); border-radius: var(--radius-sm); padding: 10px 12px; display: grid; gap: 4px; min-width: 150px; background: var(--surface-2); }
.sheet-hint.warn { border-color: var(--warning); }
.sheet-hint__label { font-size: 0.7rem; letter-spacing: 0.06em; text-transform: uppercase; color: var(--muted); font-weight: 600; }
.sheet-hint__value { font-size: 1.1rem; font-weight: 700; }
.sheet-hint__meta { font-size: 0.75rem; color: var(--muted); }
.save-grid { display: grid; gap: 12px; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); }
.save-card { border: 1px solid var(--border); border-radius: var(--radius); padding: 12px; background: var(--surface-2); display: grid; gap: 8px; }
.save-card__header { display: flex; justify-content: space-between; align-items: center; gap: 8px; }
.save-card__header .pill { border: none; }
.ability-grid { display: grid; gap: 12px; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); }
.ability-card { border: 1px solid var(--border); border-radius: var(--radius); padding: 14px; display: grid; gap: 10px; background: var(--surface-2); }
.ability-card__heading { display: flex; align-items: baseline; gap: 8px; }
.ability-card__abbr { font-size: 1.2rem; font-weight: 700; }
.ability-card__title { font-size: 0.85rem; color: var(--muted); text-transform: uppercase; letter-spacing: 0.05em; }
.ability-card__mod { display: flex; justify-content: space-between; align-items: center; font-size: 0.9rem; }
.ability-card__mod-value { font-weight: 700; }
.ability-card__summary { margin: 0; font-size: 0.85rem; color: var(--muted); }
.ability-card--wizard { background: var(--surface); }
.ability-grid--wizard { grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); }
.sheet-table-wrapper { overflow-x: auto; }
.sheet-table { width: 100%; border-collapse: collapse; min-width: 680px; }
.sheet-table th,
.sheet-table td { padding: 8px 10px; border-bottom: 1px solid var(--border); text-align: left; }
.sheet-table tbody tr:hover { background: color-mix(in srgb, var(--brand) 6%, transparent); }
.skill-table input { width: 100%; padding: 6px 8px; border-radius: var(--radius-sm); border: 1px solid var(--border); background: var(--surface); }
.skill-name { font-weight: 600; }
.skill-table__header { display: flex; align-items: center; gap: 8px; }
.skill-table__header-actions { display: flex; gap: 6px; margin-left: auto; }
.skill-table__header-actions .skill-card__icon-btn { padding-block: 2px; }
.skill-total { font-weight: 700; }
.sp-summary { display: flex; flex-wrap: wrap; gap: 12px; padding: 10px 12px; border-radius: var(--radius-sm); border: 1px solid var(--border); background: var(--surface-2); font-size: 0.9rem; }
.sp-summary.warn { border-color: var(--warning); }
.sp-summary__warning { color: var(--warning); font-weight: 600; }
.sheet-footer { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 12px; }

.world-skill-manager { display: grid; gap: 16px; }
.world-skill-manager__header { display: flex; justify-content: space-between; align-items: center; gap: 12px; flex-wrap: wrap; }
.world-skill-manager__header-actions { display: grid; gap: 8px; justify-items: end; align-items: center; }
.world-skill-manager__tools { display: flex; gap: 8px; flex-wrap: wrap; justify-content: flex-end; }
.world-skill-planner__tools { justify-content: flex-start; margin-top: 8px; }
.world-skill-planner__tools .world-skill-manager__search { min-width: 220px; }
.world-skill-manager__search { min-width: 200px; }
.world-skill-manager__sort { display: grid; gap: 4px; text-align: right; font-weight: 600; color: var(--muted); }
.world-skill-manager__sort select { min-width: 170px; }
.world-skill-manager__status { color: var(--brand-600); font-weight: 600; letter-spacing: 0.04em; }
.world-skill-grid { display: grid; gap: 14px; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); }
.world-skill-grid--planner { grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); }
.world-skill-card { position: relative; border: 1px solid var(--border); border-radius: var(--radius); padding: 16px; background: var(--surface-2); display: grid; gap: 12px; min-height: 180px; transition: border-color var(--trans-fast), box-shadow var(--trans-fast), transform var(--trans-fast); }
.world-skill-card:hover { border-color: color-mix(in oklab, var(--brand) 40%, var(--border) 60%); box-shadow: 0 8px 22px rgba(15,17,21,0.16); transform: translateY(-2px); }
.world-skill-card.is-editing { border-color: var(--brand); box-shadow: 0 12px 28px rgba(15,17,21,0.18); }
.world-skill-card__header { display: flex; justify-content: space-between; align-items: center; }
.world-skill-card__badge { display: inline-grid; place-items: center; width: 40px; height: 40px; border-radius: var(--radius); background: color-mix(in oklab, var(--brand) 18%, transparent); color: var(--brand-700); font-weight: 700; letter-spacing: 0.05em; }
.world-skill-card__delete { background: transparent; border: none; color: var(--muted); font-size: 1.35rem; line-height: 1; cursor: pointer; padding: 0; transition: color var(--trans-fast), transform var(--trans-fast); }
.world-skill-card__delete:hover:not(:disabled) { color: var(--danger); transform: scale(1.1); }
.world-skill-card__delete:disabled { opacity: 0.55; cursor: progress; }
.world-skill-card__body { display: grid; gap: 8px; align-content: start; }
.world-skill-rank-card__body { gap: 14px; }
.world-skill-card__body h4 { margin: 0; font-size: 1.05rem; color: var(--text); }
.world-skill-rank-card__heading { display: flex; flex-direction: column; gap: 2px; }
.world-skill-rank-card__summary { display: flex; justify-content: space-between; align-items: center; gap: 8px; flex-wrap: wrap; }
.world-skill-rank-card__total { display: inline-flex; align-items: baseline; gap: 6px; font-weight: 600; }
.world-skill-rank-card__fields { display: grid; gap: 10px; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); align-items: end; }
.world-skill-rank-card__take-away { justify-self: flex-start; }
.world-skill-card__actions { display: flex; gap: 8px; flex-wrap: wrap; }
.world-skill-card__form { display: grid; gap: 12px; align-content: start; }
.world-skill-card--add { border-style: dashed; border-color: color-mix(in oklab, var(--border) 70%, var(--brand) 30%); align-content: center; justify-items: center; text-align: center; }
.world-skill-card--add .world-skill-card__form { width: 100%; }
.world-skill-card__add-btn { display: grid; gap: 10px; justify-items: center; border: none; background: transparent; color: var(--muted); cursor: pointer; font-weight: 600; font-size: 0.95rem; padding: 16px; transition: color var(--trans-fast), transform var(--trans-fast); }
.world-skill-card__add-btn:hover:not(:disabled) { color: var(--brand-600); transform: translateY(-1px); }
.world-skill-card__add-btn:disabled { opacity: 0.6; cursor: not-allowed; }
.world-skill-card__plus { display: inline-grid; place-items: center; width: 44px; height: 44px; border-radius: 999px; background: color-mix(in oklab, var(--brand) 18%, transparent); color: var(--brand-700); font-size: 1.6rem; font-weight: 700; }
.world-skill-card.is-favorite { border-color: color-mix(in oklab, var(--brand) 55%, var(--border) 45%); box-shadow: 0 10px 24px rgba(15,17,21,0.22); }
.skill-card__toolbar { display: flex; gap: 6px; align-items: center; }
.skill-card__icon-btn { border: 1px solid transparent; border-radius: var(--radius-sm); background: transparent; color: var(--muted); padding: 4px 10px; font-size: 0.85rem; font-weight: 600; cursor: pointer; display: inline-flex; align-items: center; justify-content: center; transition: color var(--trans-fast), background var(--trans-fast), border-color var(--trans-fast), transform var(--trans-fast); }
.skill-card__icon-btn--star { font-size: 1.1rem; padding-inline: 8px; min-width: 34px; }
.skill-card__icon-btn:hover:not(:disabled) { color: var(--brand-600); border-color: color-mix(in oklab, var(--brand) 35%, transparent); background: color-mix(in oklab, var(--brand) 12%, transparent); transform: translateY(-1px); }
.skill-card__icon-btn.is-active { color: var(--brand-700); border-color: color-mix(in oklab, var(--brand) 55%, transparent); background: color-mix(in oklab, var(--brand) 18%, transparent); }
.skill-card__icon-btn:disabled { opacity: 0.55; cursor: not-allowed; transform: none; }
.skill-card__icon-btn:focus-visible { outline: none; border-color: var(--brand); box-shadow: var(--focus); }
.skill-hidden { border: 1px solid var(--border); border-radius: var(--radius); background: var(--surface-2); padding: 14px 16px; display: grid; gap: 12px; }
.skill-hidden__summary { display: flex; justify-content: space-between; align-items: center; gap: 12px; flex-wrap: wrap; }
.skill-hidden__summary-actions { display: flex; gap: 8px; flex-wrap: wrap; }
.skill-hidden__list { margin: 0; padding: 0; list-style: none; display: grid; gap: 8px; }
.skill-hidden__item { display: flex; flex-wrap: wrap; gap: 10px; justify-content: space-between; align-items: center; border: 1px dashed color-mix(in oklab, var(--border) 70%, transparent); border-radius: var(--radius-sm); background: var(--surface); padding: 10px 12px; }
.skill-hidden__info { display: grid; gap: 4px; min-width: 0; }
.skill-hidden__info strong { color: var(--text); }
.skill-hidden__item-actions { display: flex; gap: 8px; align-items: center; }
.world-skill-empty { border: 1px dashed var(--border); border-radius: var(--radius); padding: 16px; display: grid; gap: 6px; align-content: start; background: var(--surface); text-align: center; color: var(--muted); }
.world-skill-reference { display: grid; gap: 16px; }
.world-skill-reference__grid { display: grid; gap: 12px; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); }
.world-skill-reference__formula { display: grid; gap: 4px; padding: 12px; border: 1px solid var(--border); border-radius: var(--radius-sm); background: var(--surface-2); }
.world-skill-reference__formula code { font-size: 0.95rem; font-weight: 600; }
.world-skill-reference__callouts { display: grid; gap: 8px; }
.world-skill-reference__callouts h4 { margin: 0; color: var(--text); font-weight: 600; }
.world-skill-reference__callouts ul { margin: 0; padding-left: 18px; display: grid; gap: 4px; color: var(--muted); list-style-position: inside; }
.world-skill-reference__header { display: flex; justify-content: space-between; align-items: flex-start; gap: 12px; flex-wrap: wrap; }
.world-skill-reference__header h3 { margin: 0; }
.world-skill-reference__abilities { display: grid; gap: 12px; }
.world-skill-reference__abilities-grid { display: grid; gap: 12px; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); }
.world-skill-reference__ability { display: grid; gap: 8px; padding: 14px; border: 1px solid var(--border); border-radius: var(--radius-sm); background: var(--surface-2); }
.world-skill-reference__ability-header { display: flex; justify-content: space-between; align-items: center; gap: 8px; }
.world-skill-reference__ability ul { margin: 0; padding-left: 18px; display: grid; gap: 4px; list-style-position: inside; color: var(--muted); }
.world-skill-reference__ability li { display: grid; gap: 2px; }
.world-skill-reference__ability li strong { color: var(--text); }

.combat-skill-tab .card { display: grid; gap: 16px; }
.combat-skill-manager__header { display: flex; justify-content: space-between; align-items: flex-start; gap: 12px; flex-wrap: wrap; }
.combat-skill-manager__header h3 { margin: 0; }
.combat-skill-manager__filters { display: flex; gap: 12px; flex-wrap: wrap; align-items: flex-end; margin-top: 12px; }
.combat-skill-manager__filters label { display: grid; gap: 4px; }
.combat-skill-manager__filters input,
.combat-skill-manager__filters select { min-width: 160px; width: 100%; }
.combat-skill-grid { display: grid; gap: 16px; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); }
.combat-skill-card { border: 1px solid var(--border); border-radius: var(--radius); padding: 16px; background: var(--surface-2); display: grid; gap: 12px; transition: border-color var(--trans-fast), box-shadow var(--trans-fast), transform var(--trans-fast); }
.combat-skill-card:hover { border-color: color-mix(in oklab, var(--brand) 40%, var(--border) 60%); box-shadow: 0 8px 22px rgba(15,17,21,0.16); transform: translateY(-2px); }
.combat-skill-card.is-editing { border-color: var(--brand); box-shadow: 0 12px 28px rgba(15,17,21,0.18); }
.combat-skill-card.is-favorite { border-color: color-mix(in oklab, var(--brand) 55%, var(--border) 45%); box-shadow: 0 10px 24px rgba(15,17,21,0.22); }
.combat-skill-card__header { display: flex; justify-content: space-between; align-items: flex-start; gap: 12px; }
.combat-skill-card__heading { display: grid; gap: 6px; flex: 1 1 auto; }
.combat-skill-card__header h4 { margin: 0; font-size: 1.05rem; color: var(--text); }
.combat-skill-card__badges { display: flex; gap: 6px; flex-wrap: wrap; }
.combat-skill-card__badges .pill { border: none; }
.combat-skill-card__meta { color: var(--muted); font-weight: 600; }
.combat-skill-card__notes { margin: 0; color: var(--muted); white-space: pre-wrap; }
.combat-skill-card__actions { display: flex; gap: 8px; flex-wrap: wrap; }
.combat-skill-card--add { border: 1px dashed color-mix(in oklab, var(--border) 70%, var(--brand) 30%); align-content: center; justify-items: center; text-align: center; min-height: 220px; }
.combat-skill-card--add.is-editing { border-style: solid; }
.combat-skill-card__add-btn { border: none; background: transparent; color: var(--muted); display: grid; gap: 10px; justify-items: center; font-weight: 600; cursor: pointer; padding: 16px; transition: color var(--trans-fast), transform var(--trans-fast); }
.combat-skill-card__add-btn:hover:not(:disabled) { color: var(--brand-600); transform: translateY(-1px); }
.combat-skill-card__add-btn:disabled { opacity: 0.6; cursor: not-allowed; }
.combat-skill-card__plus { display: inline-grid; place-items: center; width: 44px; height: 44px; border-radius: 999px; background: color-mix(in oklab, var(--brand) 18%, transparent); color: var(--brand-700); font-size: 1.6rem; font-weight: 700; }
.combat-skill-editor { display: grid; gap: 12px; }
.combat-skill-editor__actions { display: flex; gap: 8px; flex-wrap: wrap; justify-content: flex-end; }
.combat-skill-manager__nav { display: flex; gap: 8px; flex-wrap: wrap; margin-top: 12px; }
.combat-skill-manager__tab { border: 1px solid var(--border); border-radius: var(--radius-sm); background: var(--surface-2); color: var(--muted); font-weight: 600; padding: 8px 14px; cursor: pointer; transition: border-color var(--trans-fast), background var(--trans-fast), color var(--trans-fast), box-shadow var(--trans-fast); }
.combat-reference { display: grid; gap: 18px; }
.combat-reference__section { display: grid; gap: 8px; }
.combat-reference__formula code { font-weight: 600; font-size: 0.95rem; }
.combat-reference__list { margin: 0; padding-left: 18px; display: grid; gap: 6px; color: var(--muted); list-style-position: inside; }
.combat-reference__list--numbered { list-style: decimal; }
.combat-reference__table-wrapper { overflow-x: auto; }
.combat-reference__table { width: 100%; border-collapse: collapse; }
.combat-reference__table th,
.combat-reference__table td { border: 1px solid var(--border); padding: 8px; text-align: left; }
.combat-reference__table th { background: var(--surface-2); font-weight: 600; }
.combat-skill-manager__tab.is-active { border-color: var(--brand); color: var(--text); background: var(--surface); box-shadow: var(--focus); }
.combat-skill-manager__tab:focus-visible { outline: none; border-color: var(--brand); box-shadow: var(--focus); }
.combat-skill-manager__tab:disabled { opacity: 0.6; cursor: default; }
.combat-calculator { border: 1px solid var(--border); border-radius: var(--radius-sm); background: var(--surface); padding: 12px; display: grid; gap: 12px; }
.combat-calculator__result { display: grid; gap: 4px; border-radius: var(--radius-sm); background: color-mix(in oklab, var(--brand) 12%, transparent); padding: 12px; }
.combat-calculator__total { font-size: 1.8rem; font-weight: 700; color: var(--text); }
.combat-calculator__footer { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 8px; }

@media (max-width: 720px) {
.combat-calculator__footer { justify-content: center; }
}

.combat-codex { display: grid; gap: 16px; }
.combat-codex__controls { display: flex; flex-wrap: wrap; gap: 12px; align-items: flex-end; }
.combat-codex__control { flex: 1 1 220px; min-width: 200px; display: grid; gap: 4px; }
.combat-codex__content { display: grid; gap: 16px; }
.combat-codex__summary { display: grid; gap: 8px; }
.combat-codex__summary h4 { margin: 0; }
.combat-codex__meta { display: flex; flex-wrap: wrap; gap: 8px; }
.combat-codex__skills { display: grid; gap: 12px; }
.combat-codex__empty { border: 1px dashed var(--border); border-radius: var(--radius); padding: 16px; text-align: center; background: var(--surface); color: var(--muted); }
.combat-codex__unmatched { border-top: 1px solid var(--border); padding-top: 12px; }

/* Demon codex */
.demon-codex { display: grid; gap: 16px; }
.demon-codex__layout { display: flex; flex-direction: column; gap: 16px; }
.demon-codex__main { display: grid; gap: 16px; flex: 1 1 auto; }
.demon-codex__panel { display: grid; gap: 16px; }
.demon-codex__panel-header { display: flex; justify-content: space-between; align-items: flex-start; gap: 12px; flex-wrap: wrap; }
.demon-codex__pool-usage { align-self: flex-start; font-weight: 600; }
.demon-codex__tabs { display: flex; flex-wrap: wrap; gap: 8px; }
.demon-codex__tab-btn { border: 1px solid var(--border); border-radius: var(--radius-sm); padding: 6px 14px; font-weight: 600; background: var(--surface-2); color: var(--muted); cursor: pointer; transition: border-color var(--trans-fast), background var(--trans-fast), color var(--trans-fast), box-shadow var(--trans-fast); }
.demon-codex__tab-btn:hover { border-color: color-mix(in oklab, var(--brand) 35%, var(--border)); color: var(--text); }
.demon-codex__tab-btn.is-active { border-color: var(--brand); color: var(--text); background: var(--surface); box-shadow: var(--focus); }
.demon-codex__tab-btn:focus-visible { outline: none; border-color: var(--brand); box-shadow: var(--focus); }
.demon-codex__content { display: grid; gap: 16px; }
.demon-codex__aside { flex: 1 1 auto; display: grid; }
.demon-codex__pool-mobile { display: none; justify-self: flex-start; margin-bottom: 12px; }

.demon-lookup { display: grid; gap: 12px; }
.demon-lookup__controls { display: flex; gap: 8px; flex-wrap: wrap; align-items: flex-end; }
.demon-lookup__field { flex: 1 1 240px; min-width: 220px; }
.demon-lookup__results { display: grid; gap: 8px; max-height: 280px; overflow-y: auto; padding-right: 4px; }
.demon-lookup__result { display: flex; justify-content: space-between; align-items: center; gap: 12px; padding: 10px 12px; border: 1px solid var(--border); border-radius: var(--radius-sm); background: var(--surface-2); }
.demon-lookup__name { font-weight: 600; }
.demon-lookup__empty { border: 1px dashed var(--border); border-radius: var(--radius-sm); padding: 16px; text-align: center; }

.demon-editor { display: grid; gap: 16px; align-content: start; }
.demon-editor__content { display: grid; gap: 16px; }
.demon-editor__header { display: flex; justify-content: space-between; align-items: flex-start; gap: 12px; }
.demon-editor__title { margin: 0; }
.demon-editor__actions { display: flex; gap: 8px; flex-wrap: wrap; }
.demon-editor__section { display: grid; gap: 12px; }
.demon-editor__row { display: flex; gap: 12px; flex-wrap: wrap; }
.demon-editor__field { flex: 1 1 180px; min-width: 180px; }
.demon-editor__field--compact { flex: 0 0 120px; }
.demon-editor__field--wide { flex: 1 1 260px; min-width: 240px; }
.demon-editor__stats-grid { display: grid; gap: 8px; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); }
.demon-editor__stat-field { gap: 4px; }
.demon-editor__resist-grid { display: grid; gap: 8px; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); }
.demon-editor__resist-field textarea { min-height: 72px; }
.demon-editor__preview { display: grid; gap: 12px; }
.demon-editor__preview-body { display: grid; gap: 12px; }
.demon-editor__preview-image { width: 100%; border-radius: var(--radius); border: 1px solid var(--border); background: #0b0c10; object-fit: cover; max-height: 260px; }
.demon-editor__preview-meta { display: grid; gap: 8px; }
.demon-editor__preview-stats { display: flex; flex-wrap: wrap; gap: 6px; }
.demon-editor__preview-resists { display: grid; gap: 4px; }

.demon-fusion {
    display: grid;
    gap: 16px;
    padding: 16px;
    border-radius: var(--radius);
    border: 1px solid color-mix(in oklab, var(--brand) 18%, var(--border));
    background: color-mix(in oklab, var(--brand) 6%, transparent);
}

.demon-fusion__intro { display: grid; gap: 4px; }

.demon-fusion__grid {
    display: grid;
    gap: 16px;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
}

.demon-fusion__slot,
.demon-fusion__summary,
.demon-fusion__chart {
    display: grid;
    gap: 12px;
    padding: 16px;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    box-shadow: var(--shadow-sm);
}

.demon-fusion__slot-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 12px;
}

.demon-fusion__chart-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 12px;
}

.demon-fusion__chart-actions {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
}

.demon-fusion__chart-grid {
    overflow: auto;
    border-radius: var(--radius);
    border: 1px solid var(--border);
    background: var(--surface-2);
    max-height: 480px;
}

.demon-fusion__chart-table {
    border-collapse: collapse;
    width: 100%;
    min-width: 720px;
    font-size: 0.85rem;
}

.demon-fusion__chart-table th,
.demon-fusion__chart-table td {
    border: 1px solid var(--border);
    padding: 6px;
    text-align: center;
    background: var(--surface);
}

.demon-fusion__chart-table thead th {
    position: sticky;
    top: 0;
    background: var(--surface-2);
    z-index: 1;
}

.demon-fusion__chart-table thead th.demon-fusion__chart-corner {
    left: 0;
    z-index: 2;
}

.demon-fusion__chart-table tbody th {
    background: var(--surface-2);
    position: sticky;
    left: 0;
    text-align: left;
    z-index: 1;
    font-weight: 600;
}

.demon-fusion__chart-corner {
    text-align: left;
    min-width: 140px;
}

.demon-fusion__chart-select {
    width: 100%;
    min-width: 110px;
    font-size: 0.82rem;
}

.demon-fusion__chart-cell.has-override {
    background: color-mix(in oklab, var(--brand) 12%, transparent);
}

.demon-fusion__results {
    display: grid;
    gap: 8px;
    max-height: 220px;
    overflow-y: auto;
    padding-right: 4px;
}

.demon-fusion__result {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 12px;
    padding: 8px 12px;
    border: 1px solid var(--border);
    border-radius: var(--radius-sm);
    background: var(--surface-2);
    cursor: pointer;
    transition: border-color var(--trans-fast), background var(--trans-fast), box-shadow var(--trans-fast);
}

.demon-fusion__result:hover,
.demon-fusion__result:focus-visible {
    outline: none;
    border-color: var(--brand);
    background: color-mix(in oklab, var(--brand) 12%, var(--surface-2));
    box-shadow: var(--shadow-sm);
}

.demon-fusion__result-name { font-weight: 600; }

.demon-fusion__selection {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 12px;
    padding: 12px;
    border-radius: var(--radius);
    border: 1px solid color-mix(in oklab, var(--brand) 30%, var(--border));
    background: color-mix(in oklab, var(--brand) 8%, var(--surface-1));
}

.demon-fusion__selection-actions { display: flex; gap: 8px; flex-wrap: wrap; }

.demon-fusion__empty {
    padding: 12px;
    border: 1px dashed var(--border);
    border-radius: var(--radius-sm);
    text-align: center;
    background: var(--surface-1);
}

.demon-fusion__summary-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 12px;
}

.demon-fusion__summary-grid { display: grid; gap: 8px; }

.demon-fusion__summary-row {
    display: flex;
    justify-content: space-between;
    gap: 12px;
    font-size: 0.9rem;
}

.demon-fusion__summary-note {
    margin-top: 8px;
    padding: 8px 10px;
    border-radius: var(--radius-sm);
    border: 1px solid color-mix(in oklab, var(--brand) 28%, var(--border));
    background: color-mix(in oklab, var(--brand) 10%, var(--surface-1));
}

.demon-fusion__result-card {
    display: grid;
    gap: 12px;
    padding: 14px;
    border: 1px solid color-mix(in oklab, var(--brand) 28%, var(--border));
    border-radius: var(--radius);
    background: color-mix(in oklab, var(--brand) 10%, var(--surface));
}

.demon-fusion__result-meta { display: grid; gap: 6px; }

.demon-fusion__result-stats { display: flex; flex-wrap: wrap; gap: 8px; }

.demon-fusion__result-resist { display: grid; gap: 4px; }

.demon-fusion__result-skills { display: grid; gap: 4px; font-size: 0.85rem; }

.demon-fusion__candidate-nav { display: flex; flex-wrap: wrap; gap: 8px; }

.demon-fusion__actions { display: flex; flex-wrap: wrap; gap: 8px; }

.demon-fusion__candidate-list { display: grid; gap: 8px; }

.demon-fusion__candidate-scroll {
    max-height: 240px;
    overflow-y: auto;
    border: 1px solid var(--border);
    border-radius: var(--radius);
    background: var(--surface-1);
}

.demon-fusion__candidate {
    width: 100%;
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 12px;
    padding: 8px 12px;
    background: transparent;
    border: none;
    border-bottom: 1px solid var(--border);
    cursor: default;
    text-align: left;
    font-size: 0.9rem;
}

.demon-fusion__candidate:last-child { border-bottom: none; }

.demon-fusion__candidate:hover,
.demon-fusion__candidate:focus-visible {
    outline: none;
    background: color-mix(in oklab, var(--brand) 12%, transparent);
}

.demon-fusion__candidate.is-active {
    background: color-mix(in oklab, var(--brand) 18%, transparent);
    font-weight: 600;
}

.demon-fusion__history {
    display: grid;
    gap: 12px;
    margin-top: 16px;
}

.demon-fusion__history-list {
    display: grid;
    gap: 10px;
}

.demon-fusion__history-entry {
    display: grid;
    gap: 6px;
    padding: 10px 12px;
    border-radius: var(--radius);
    border: 1px solid color-mix(in oklab, var(--brand) 18%, var(--border));
    background: color-mix(in oklab, var(--brand) 6%, var(--surface));
    box-shadow: var(--shadow-sm);
}

.demon-fusion__history-header-row {
    display: flex;
    justify-content: space-between;
    gap: 12px;
    align-items: baseline;
}

@media (max-width: 720px) {
    .demon-fusion__grid { grid-template-columns: 1fr; }
}

@media (min-width: 960px) {
    .demon-codex__layout { flex-direction: row; align-items: flex-start; }
    .demon-codex__main { flex: 2 1 0; }
    .demon-codex__aside { flex: 1 1 360px; position: sticky; top: 0; align-self: flex-start; }
}

@media (max-width: 959px) {
    .demon-codex__pool-usage { display: none; }
    .demon-codex__pool-mobile { display: inline-flex; }
    .demon-codex__panel-header { flex-direction: column; align-items: flex-start; }
}

.demon-codex__filters { display: flex; flex-wrap: wrap; gap: 12px; margin-top: 16px; align-items: flex-end; }
.demon-codex__filter { flex: 1 1 180px; min-width: 180px; }
.demon-codex__clear { align-self: center; }
.demon-codex__grid { margin-top: 16px; display: grid; gap: 16px; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); }
.demon-codex__empty { margin-top: 16px; padding: 24px; border: 1px dashed var(--border); border-radius: var(--radius); text-align: center; }

.demon-card {
    display: grid;
    gap: 14px;
    padding: 18px 20px;
    border-radius: var(--radius);
    border: 1px solid color-mix(in oklab, var(--border) 60%, transparent);
    background: linear-gradient(135deg, color-mix(in oklab, var(--brand) 6%, transparent), color-mix(in oklab, var(--surface-2) 85%, transparent));
    box-shadow: var(--shadow-sm);
}

.demon-card__top {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 16px;
}

.demon-card__identity {
    display: grid;
    gap: 6px;
}

.demon-card__name {
    font-size: 1.2rem;
    letter-spacing: 0.02em;
}

.demon-card__chips {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
}

.demon-card__chip {
    display: inline-flex;
    align-items: center;
    border-radius: 999px;
    padding: 4px 10px;
    font-size: 0.75rem;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    background: color-mix(in oklab, var(--brand) 16%, transparent);
    border: 1px solid color-mix(in oklab, var(--brand) 22%, transparent);
}

.demon-card__actions {
    display: flex;
    gap: 10px;
    align-items: flex-end;
}

.demon-card__level {
    font-size: 0.85rem;
    font-weight: 600;
    padding: 4px 10px;
    border-radius: 999px;
    background: color-mix(in oklab, var(--brand) 12%, transparent);
}

.demon-card__buttons {
    display: flex;
    gap: 6px;
    flex-wrap: wrap;
    justify-content: flex-end;
}

.demon-card__description {
    margin: 0;
    color: var(--muted);
    font-size: 0.9rem;
}

.demon-card__body {
    display: grid;
    grid-template-columns: minmax(0, auto) minmax(0, 1fr);
    gap: 16px;
    align-items: stretch;
}

.demon-card__portrait {
    width: 120px;
    height: 120px;
    object-fit: cover;
    border-radius: var(--radius);
    border: 1px solid var(--border);
    background: #0b0c10;
}

.demon-card__info {
    display: grid;
    gap: 12px;
}

.demon-card__stats-row {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(110px, 1fr));
    gap: 8px;
}

.demon-card__stat {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 10px;
    border-radius: var(--radius-sm);
    background: color-mix(in oklab, var(--surface-2) 70%, transparent);
    border: 1px solid color-mix(in oklab, var(--border) 65%, transparent);
    font-size: 0.9rem;
}

.demon-card__stat-key {
    font-weight: 600;
    letter-spacing: 0.05em;
    text-transform: uppercase;
    font-size: 0.75rem;
}

.demon-card__resist-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
    gap: 8px;
    font-size: 0.85rem;
}

.demon-card__resist {
    display: grid;
    gap: 4px;
    padding: 8px 10px;
    border-radius: var(--radius-sm);
    background: color-mix(in oklab, var(--brand) 10%, transparent);
    border: 1px solid color-mix(in oklab, var(--brand) 18%, transparent);
}

.demon-card__resist-label {
    font-size: 0.7rem;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    color: color-mix(in oklab, var(--brand) 70%, var(--text) 30%);
}

.demon-card__resist-values {
    font-weight: 500;
}

.demon-card__skills {
    display: grid;
    gap: 6px;
}

.demon-card__section-label {
    font-size: 0.75rem;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    color: var(--muted);
}

.demon-card__skill-list {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
}

.demon-card__skill-chip {
    display: inline-flex;
    align-items: center;
    padding: 6px 10px;
    border-radius: 999px;
    background: color-mix(in oklab, var(--surface-2) 80%, transparent);
    border: 1px solid color-mix(in oklab, var(--border) 60%, transparent);
    font-size: 0.82rem;
}

.demon-card__skills-btn {
    justify-self: flex-start;
}

.demon-card__notes {
    border-top: 1px solid color-mix(in oklab, var(--border) 70%, transparent);
    padding-top: 8px;
    color: var(--muted);
    font-size: 0.85rem;
}

.demon-image--interactive {
    cursor: zoom-in;
    transition: transform var(--trans-fast);
}

.demon-image--interactive:focus-visible {
    outline: 2px solid var(--brand);
    outline-offset: 3px;
}

.demon-image-lightbox {
    position: fixed;
    inset: 0;
    background: rgba(12, 14, 20, 0.7);
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 24px;
    z-index: 45;
}

.demon-image-lightbox__body {
    background: var(--surface);
    border-radius: var(--radius);
    border: 1px solid var(--border);
    box-shadow: var(--shadow-md);
    padding: 16px;
    display: grid;
    gap: 12px;
    max-width: min(720px, 92vw);
    max-height: min(90vh, 720px);
}

.demon-image-lightbox__image {
    max-height: calc(90vh - 96px);
    max-width: calc(min(720px, 92vw) - 32px);
    width: auto;
    border-radius: var(--radius-sm);
    background: var(--surface-2);
    object-fit: contain;
    justify-self: center;
}

.demon-image-lightbox__close {
    justify-self: end;
}

@media (max-width: 720px) {
    .demon-card__body { grid-template-columns: 1fr; }
    .demon-card__actions { align-items: flex-start; flex-direction: column; }
    .demon-card__portrait { width: 100%; height: 200px; }
}

.demon-skill-overlay { position: fixed; inset: 0; background: rgba(12, 14, 20, 0.55); display: flex; align-items: center; justify-content: center; padding: 24px; z-index: 40; }
.demon-skill-modal { background: var(--surface); border-radius: var(--radius); border: 1px solid var(--border); box-shadow: var(--shadow-md); width: min(520px, 95vw); max-height: 85vh; display: grid; gap: 16px; padding: 20px 22px; overflow: hidden; }
.demon-skill-modal__header { display: flex; justify-content: space-between; align-items: flex-start; gap: 12px; }
.demon-skill-modal__list { display: grid; gap: 12px; overflow-y: auto; padding-right: 4px; }
.demon-skill-modal__item { border: 1px solid var(--border); border-radius: var(--radius-sm); padding: 12px; background: var(--surface-2); display: grid; gap: 6px; }
.demon-skill-modal__item-header { display: flex; justify-content: space-between; align-items: flex-start; gap: 8px; }
.demon-skill-modal__badges { display: flex; flex-wrap: wrap; gap: 6px; }
.demon-skill-modal__actions { display: flex; align-items: center; gap: 8px; margin-top: 8px; }
.demon-skill-modal__empty { text-align: center; padding: 16px; border-radius: var(--radius-sm); background: color-mix(in oklab, var(--brand) 6%, transparent); }
.demon-skill-modal__unmatched { border-top: 1px solid var(--border); padding-top: 12px; }
.combat-codex__skills--suggestions { margin-top: 16px; }

/* Wizard overlay */
.wizard-backdrop { position: fixed; inset: 0; background: rgba(15, 17, 21, 0.78); display: grid; place-items: center; padding: 24px; z-index: 20; }
.wizard-panel { width: min(960px, 100%); max-height: 100%; overflow: hidden; border-radius: var(--radius-lg); background: var(--surface); display: grid; grid-template-rows: auto auto 1fr auto; box-shadow: 0 30px 80px rgba(0,0,0,0.35); }
.wizard-header { display: flex; justify-content: space-between; align-items: flex-start; padding: 16px 24px; gap: 12px; border-bottom: 1px solid var(--border); flex-wrap: wrap; }
.wizard-header__text { flex: 1 1 280px; display: grid; gap: 8px; }
.wizard-header__actions { display: flex; align-items: center; gap: 8px; }
.wizard-progress { position: relative; width: 100%; height: 6px; border-radius: 999px; background: color-mix(in srgb, var(--brand) 12%, transparent); overflow: hidden; }
.wizard-progress__bar { position: absolute; inset: 0; background: var(--brand); transition: width var(--trans-fast) ease-in-out; border-radius: inherit; }
.wizard-progress__meta { font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.08em; color: var(--muted); font-weight: 600; }
.wizard-stepper { display: flex; flex-wrap: wrap; gap: 8px; padding: 12px 24px; border-bottom: 1px solid var(--border); }
.wizard-step { flex: 1 1 160px; border: 1px solid var(--border); border-radius: var(--radius-sm); padding: 8px 10px; background: var(--surface-2); color: var(--muted); font-weight: 600; letter-spacing: 0.03em; cursor: pointer; transition: border-color var(--trans-fast), background var(--trans-fast), color var(--trans-fast); }
.wizard-step.is-active { border-color: var(--brand); color: var(--text); box-shadow: var(--focus); background: var(--surface); }
.wizard-step.is-complete { border-color: var(--success); color: var(--success); }
.wizard-step:disabled { opacity: 0.6; cursor: default; }
.wizard-step__label { display: block; text-align: center; font-size: 0.75rem; text-transform: uppercase; }
.wizard-content { padding: 24px; overflow-y: auto; max-height: 60vh; }
.wizard-footer { padding: 16px 24px; border-top: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; gap: 12px; flex-wrap: wrap; }
.wizard-footer__actions { display: flex; gap: 8px; }

.wizard-prompt { display: grid; gap: 12px; border: 1px dashed color-mix(in srgb, var(--brand) 35%, transparent); border-radius: var(--radius); background: color-mix(in srgb, var(--brand) 10%, transparent); padding: 16px; }
.wizard-prompt__body { display: grid; gap: 6px; }
.wizard-prompt__title { font-size: 0.8rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.08em; color: var(--brand); }
.wizard-prompt__hook { margin: 0; font-weight: 600; }
.wizard-prompt__question { margin: 0; color: var(--muted); font-style: italic; }
.wizard-prompt__actions { display: flex; flex-wrap: wrap; gap: 8px; }
.wizard-prompt__hint { font-size: 0.75rem; font-weight: 600; color: var(--success); }

.persona-overlay {
    position: fixed;
    inset: 0;
    background: rgba(12, 14, 20, 0.45);
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 24px;
    pointer-events: none;
    z-index: 30;
}

.persona-modal {
    pointer-events: auto;
    background: var(--surface);
    border-radius: var(--radius);
    border: 1px solid var(--border);
    box-shadow: var(--shadow-md);
    width: min(520px, 92vw);
    display: grid;
    gap: 16px;
    padding: 20px 22px;
}

.persona-modal__header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 12px;
}

.persona-modal__body {
    display: grid;
    gap: 12px;
}

.persona-modal__actions {
    display: flex;
    gap: 8px;
    justify-content: flex-end;
}

.persona-modal__timer {
    font-size: 0.85rem;
    font-weight: 600;
    color: var(--muted);
}

.trade-overlay {
    position: fixed;
    inset: 0;
    display: grid;
    gap: 16px;
    align-content: center;
    justify-items: center;
    padding: 24px;
    pointer-events: none;
    z-index: 24;
}

.trade-window {
    pointer-events: auto;
    background: var(--surface);
    border-radius: var(--radius);
    border: 1px solid var(--border);
    box-shadow: var(--shadow-md);
    width: min(760px, 96vw);
    display: grid;
    gap: 16px;
    padding: 20px 22px;
}

.trade-window__header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 12px;
    flex-wrap: wrap;
}

.trade-window__timer {
    font-size: 0.85rem;
    font-weight: 600;
    color: var(--muted);
}

.trade-window__note {
    margin: 4px 0 0;
    font-style: italic;
    color: var(--muted);
}

.trade-window__columns {
    display: grid;
    gap: 16px;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
}

.trade-window__column {
    display: grid;
    gap: 12px;
}

.trade-window__column h4 {
    margin: 0;
}

.trade-offer {
    display: grid;
    gap: 12px;
    border: 1px solid var(--border);
    border-radius: var(--radius-sm);
    padding: 12px;
    background: color-mix(in srgb, var(--surface) 92%, transparent);
}

.trade-offer__row {
    display: flex;
    gap: 12px;
    align-items: flex-start;
    justify-content: space-between;
    flex-wrap: wrap;
}

.trade-offer__info {
    display: grid;
    gap: 6px;
    flex: 1;
    min-width: 0;
}

.trade-offer__name {
    font-weight: 600;
}

.trade-offer__meta {
    display: flex;
    gap: 6px;
    align-items: center;
    flex-wrap: wrap;
    font-size: 0.75rem;
    color: var(--muted);
}

.trade-offer__desc {
    margin: 0;
    color: var(--muted);
}

.trade-offer__controls {
    display: grid;
    gap: 6px;
    justify-items: flex-start;
}

.trade-offer__controls input {
    width: 80px;
}

.trade-offer__picker {
    display: grid;
    gap: 6px;
}

.trade-offer__footer {
    display: flex;
    justify-content: flex-end;
}

.trade-offer__empty {
    margin: 0;
    font-size: 0.85rem;
}

.trade-window__warning {
    margin: 0;
    color: var(--warning);
}

.trade-window__footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 12px;
    flex-wrap: wrap;
}

.trade-window__status {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
}

.trade-window__actions {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
    justify-content: flex-end;
}

.trade-window__actions--invite {
    justify-content: flex-end;
    gap: 8px;
}

.trade-window__body {
    display: grid;
    gap: 12px;
}

.trade-window__message {
    margin: 0;
}
.wizard-stack { display: grid; gap: 16px; }
.wizard-grid { display: grid; gap: 12px; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); }
.wizard-grid--stretch { grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); }
.wizard-role-card {
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 12px;
    background: var(--surface-2);
    display: grid;
    gap: 6px;
    cursor: pointer;
    text-align: left;
    color: inherit;
    transition: border-color var(--trans-fast), box-shadow var(--trans-fast), transform var(--trans-fast);
    font: inherit;
}
.wizard-role-card:hover {
    border-color: var(--border-strong);
}
.wizard-role-card:focus-visible {
    outline: none;
    border-color: var(--brand);
    box-shadow: var(--focus);
}
.wizard-role-card.is-selected {
    border-color: var(--brand);
    box-shadow: var(--focus);
}
.wizard-role-card h5 { margin: 0; font-size: 1rem; }
.wizard-role-meta { font-size: 0.85rem; color: var(--muted); }
.wizard-role-row { display: flex; gap: 8px; align-items: center; font-size: 0.85rem; }
.wizard-role-row .pill { border: none; }
.wizard-role-card__cta {
    font-size: 0.85rem;
    font-weight: 600;
    color: var(--brand);
    display: inline-flex;
    align-items: center;
    gap: 4px;
}
.wizard-role-card.is-selected .wizard-role-card__cta {
    color: var(--muted);
}
.wizard-roller { display: flex; flex-wrap: wrap; gap: 12px; align-items: center; }
.wizard-rolled { display: flex; flex-wrap: wrap; gap: 12px; align-items: center; font-size: 0.9rem; }
.wizard-arcana-grid { display: grid; gap: 12px; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); }
.wizard-arcana-card { border: 1px solid var(--border); border-radius: var(--radius); padding: 12px; display: grid; gap: 10px; cursor: pointer; background: var(--surface-2); transition: border-color var(--trans-fast), box-shadow var(--trans-fast); }
.wizard-arcana-card input { display: none; }
.wizard-arcana-card.is-selected { border-color: var(--brand); box-shadow: var(--focus); }
.wizard-arcana-card__title { font-weight: 700; }
.wizard-arcana-card__row { display: flex; gap: 8px; align-items: center; font-size: 0.85rem; }
.wizard-actions { display: flex; justify-content: flex-end; }
.wizard-sp-summary { display: flex; flex-wrap: wrap; gap: 12px; padding: 10px 12px; border-radius: var(--radius-sm); border: 1px solid var(--border); background: var(--surface-2); }
.wizard-sp-summary.warn { border-color: var(--warning); }
.wizard-warning { padding: 10px 12px; border-radius: var(--radius-sm); background: color-mix(in srgb, var(--warning) 18%, transparent); font-weight: 600; }
.wizard-summary { display: grid; gap: 16px; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); }
.wizard-summary__section { border: 1px solid var(--border); border-radius: var(--radius); padding: 12px; background: var(--surface-2); display: grid; gap: 8px; }
.wizard-summary__section dl { margin: 0; display: grid; gap: 4px; }
.wizard-summary__section dl div { display: flex; justify-content: space-between; gap: 12px; }
.wizard-summary__section ul { margin: 0; padding-left: 18px; display: grid; gap: 4px; }
.wizard-info { border: 1px solid var(--border); border-radius: var(--radius); padding: 12px; background: var(--surface-2); display: grid; gap: 8px; }
.wizard-info ol { margin: 0; padding-left: 18px; display: grid; gap: 4px; }

@media (max-width: 720px) {
    .sheet-table { min-width: 540px; }
    .wizard-panel { grid-template-rows: auto auto 1fr auto; }
    .wizard-content { max-height: 55vh; }
}

.perm-toggle__label {
    font-weight: 600;
    color: var(--text);
}

.perm-toggle.is-readonly {
    opacity: .7;
    cursor: not-allowed;
}

/* Images */
img {
    display: block;
    max-width: 100%;
    height: auto;
    border-radius: 12px;
    border: 1px solid var(--border);
    background: var(--surface-2);
}

/* Tooltips (simple) */
[title] {
    position: relative;
}

/* Animations & motion preferences */
@media (prefers-reduced-motion: reduce) {
    * { transition: none !important; animation: none !important; }
}

/* Item & inventory cards */
.item-filter-bar {
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
    align-items: flex-end;
    margin-bottom: 12px;
}

.item-filter-bar__field {
    flex: 1 1 240px;
    min-width: 200px;
}

.item-filter-bar__field input {
    width: 100%;
}

.item-filter-bar__controls {
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
    align-items: center;
}

.item-filter-bar__control {
    display: flex;
    flex-direction: column;
    gap: 4px;
    font-size: 0.8rem;
    color: var(--muted);
}

.item-filter-bar__control select {
    min-width: 160px;
}

.item-filter-bar__favorites {
    flex-direction: row;
    align-items: center;
    font-size: 0.85rem;
    gap: 6px;
}

.item-card-grid {
    display: grid;
    gap: 16px;
    grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
}

.item-card {
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 12px;
    background: var(--surface-2);
    display: flex;
    flex-direction: column;
    gap: 8px;
    position: relative;
    transition: border-color var(--trans-fast), box-shadow var(--trans-fast);
}

.item-card.is-favorite {
    border-color: var(--brand);
    box-shadow: var(--focus);
}

.item-card__header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 8px;
}

.item-card__title {
    font-weight: 600;
}

.item-card__meta {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    align-items: center;
    font-size: 0.85rem;
    color: var(--muted);
}

.item-card__desc {
    font-size: 0.9rem;
    color: var(--muted);
}

.item-card__tags {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
}

.item-tag {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    padding: 2px 8px;
    border-radius: 999px;
    border: 1px solid color-mix(in srgb, var(--brand) 18%, transparent);
    background: color-mix(in srgb, var(--brand) 10%, transparent);
    font-size: 0.75rem;
    font-weight: 600;
    color: color-mix(in srgb, var(--brand) 55%, var(--text) 45%);
}

.item-card__linked {
    color: var(--muted);
}

.item-card__effects {
    display: grid;
    gap: 4px;
}

.item-card__effect-list {
    margin: 4px 0 0;
    padding-left: 18px;
    display: grid;
    gap: 4px;
    font-size: 0.8rem;
    color: var(--muted);
}

.item-card__section-title {
    font-weight: 600;
}

.item-card__actions {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-top: auto;
}

.favorite-toggle {
    border: none;
    background: none;
    font-size: 1.1rem;
    line-height: 1;
    cursor: pointer;
    color: var(--muted);
    padding: 2px 4px;
    transition: color var(--trans-fast), text-shadow var(--trans-fast);
}

.favorite-toggle:hover {
    color: var(--brand);
}

.favorite-toggle.is-active {
    color: var(--brand);
    text-shadow: 0 0 6px color-mix(in srgb, var(--brand) 45%, transparent);
}

.item-trade-bar {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: 8px;
    margin-top: 16px;
}

.item-trade-bar select {
    min-width: 180px;
}

.item-trade-bar__label {
    font-weight: 600;
}

.item-trade-bar__notice {
    font-size: 0.8rem;
    color: var(--muted);
}

.item-trade-bar__notice.is-error {
    color: var(--error);
}

.item-trade-bar__notice.is-success {
    color: var(--success);
}

.item-effect-editor {
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 12px;
    background: color-mix(in srgb, var(--surface-2) 90%, var(--bg) 10%);
    display: grid;
    gap: 12px;
    margin-top: 12px;
}

.item-effect-editor__list {
    display: grid;
    gap: 12px;
}

.item-effect-editor__list > div {
    border: 1px solid var(--border);
    border-radius: var(--radius-sm);
    padding: 12px;
    background: var(--surface-1, var(--surface-2));
}

.map-toolbar__combat {
    margin-top: 12px;
}

.map-combat-card {
    border: 1px solid var(--border);
    border-radius: var(--radius);
    background: var(--surface-2);
    padding: 12px;
    display: grid;
    gap: 12px;
    width: 100%;
}

.map-combat-card__summary {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    align-items: center;
}

.map-combat-timeline {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    align-items: stretch;
    width: 100%;
}

.map-combat-timeline__entry {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 6px 10px;
    border-radius: 999px;
    border: 1px solid color-mix(in srgb, var(--border) 80%, transparent);
    background: color-mix(in srgb, var(--surface-2) 85%, var(--bg) 15%);
    font-size: 0.8rem;
    color: color-mix(in srgb, var(--muted) 85%, var(--text) 15%);
    transition: border-color var(--trans-fast), box-shadow var(--trans-fast);
}

.map-combat-timeline__entry.is-current {
    border-color: color-mix(in srgb, var(--brand) 70%, var(--border) 30%);
    box-shadow: 0 0 0 2px color-mix(in srgb, var(--brand) 25%, transparent);
    background: color-mix(in srgb, var(--brand) 20%, transparent);
    color: color-mix(in srgb, var(--brand) 55%, var(--text) 45%);
    font-weight: 600;
}

.map-combat-timeline__entry.is-complete {
    border-color: color-mix(in srgb, var(--success) 40%, var(--border) 60%);
    background: color-mix(in srgb, var(--success) 15%, transparent);
    color: color-mix(in srgb, var(--success) 55%, var(--text) 45%);
}

.map-combat-timeline__step {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: color-mix(in srgb, currentColor 20%, transparent);
    font-size: 0.7rem;
    font-weight: 600;
}

.map-combat-timeline__entry.is-current .map-combat-timeline__step {
    background: color-mix(in srgb, var(--brand) 55%, var(--bg) 45%);
    color: color-mix(in srgb, var(--text) 65%, var(--brand) 35%);
}

.map-combat-timeline__entry.is-complete .map-combat-timeline__step {
    background: color-mix(in srgb, var(--success) 40%, var(--bg) 60%);
    color: color-mix(in srgb, var(--success) 70%, var(--text) 30%);
}

.map-combat-timeline__label {
    line-height: 1.2;
}

.map-combat-card__form {
    display: grid;
    gap: 12px;
}

.map-combat-card__inputs {
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
}

.map-combat-card__actions {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
}

.map-combat-card__order {
    font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
    background: color-mix(in srgb, var(--surface-2) 85%, var(--bg) 15%);
    padding: 2px 8px;
    border-radius: var(--radius-sm);
}

.map-combat-card__notice {
    font-size: 0.8rem;
}

.map-combat-card--readonly {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    align-items: center;
    border: 1px dashed var(--border);
    border-radius: var(--radius);
    background: color-mix(in srgb, var(--surface-2) 92%, var(--bg) 8%);
    padding: 10px 12px;
}

/* Scrollbar (webkit) */
*::-webkit-scrollbar {
    width: 10px;
    height: 10px;
}
*::-webkit-scrollbar-track {
    background: transparent;
}
*::-webkit-scrollbar-thumb {
    background: color-mix(in oklab, var(--text) 12%, transparent);
    border-radius: 999px;
    border: 2px solid transparent;
    background-clip: padding-box;
}
*::-webkit-scrollbar-thumb:hover {
    background: color-mix(in oklab, var(--text) 22%, transparent);
}

/* Utility helpers */
.muted { color: var(--muted); }
.right { margin-left: auto; }
.center { display: grid; place-items: center; }
.hidden { display: none !important; }

.max-w-sm { max-width: 420px; }
.max-w-md { max-width: 720px; }
.max-w-lg { max-width: 1024px; }

.pad-sm { padding: 8px; }
.pad    { padding: 16px; }
.pad-lg { padding: 24px; }

/* Headers that stick */
.sticky-header {
    position: sticky;
    top: 0;
    z-index: 10;
    background: var(--bg);
    padding: 12px 0;
}

/* Subtle hover rows */
.row.hoverable {
    border: 1px solid transparent;
    border-radius: var(--radius-sm);
    padding: 6px 8px;
    transition: background var(--trans-fast), border-color var(--trans-fast);
}
.row.hoverable:hover {
    background: var(--surface-2);
    border-color: var(--border);
}

/* Skeleton loader */
.skeleton {
    --sk: linear-gradient(90deg, transparent, rgba(255,255,255,.2), transparent);
    background: color-mix(in oklab, var(--text) 8%, transparent);
    border-radius: 8px;
    position: relative;
    overflow: hidden;
}
.skeleton::after {
    content: "";
    position: absolute;
    inset: 0;
    transform: translateX(-100%);
    animation: sk 1.4s infinite;
    background: var(--sk);
}
@keyframes sk {
    to { transform: translateX(100%); }
}

/* Code blocks (if needed) */
code, pre {
    font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
    background: var(--surface-2);
    border: 1px solid var(--border);
    border-radius: 8px;
}
code { padding: 2px 6px; }
pre  { padding: 12px; overflow: auto; }

/* Media queries for tighter mobile spacing */
@media (max-width: 640px) {
    #root { padding: 12px; }
    .btn { padding: 8px 12px; }
    .card { padding: 12px; }
    .tabs { gap: 4px; }
    .tab { padding: 8px 10px; }
}

/* Matrix loading effect */
.matrix-rain {
    position: fixed;
    inset: 0;
    pointer-events: none;
    z-index: 1200;
    opacity: 0;
    transition: opacity 240ms ease;
    mix-blend-mode: screen;
}

.matrix-rain.is-visible {
    opacity: 1;
}

.matrix-rain canvas {
    width: 100%;
    height: 100%;
    display: block;
    filter: saturate(1.2);
}

.matrix-rain__glow {
    position: absolute;
    inset: 0;
    pointer-events: none;
    background:
        radial-gradient(circle at 20% 18%, rgba(102, 255, 190, 0.22), transparent 55%),
        radial-gradient(circle at 78% 22%, rgba(72, 203, 255, 0.18), transparent 50%),
        radial-gradient(circle at 50% 70%, rgba(40, 255, 150, 0.16), transparent 58%);
    mix-blend-mode: screen;
    opacity: 0.75;
    transition: opacity var(--trans-fast);
}

.matrix-rain.is-active .matrix-rain__glow {
    opacity: 1;
}
